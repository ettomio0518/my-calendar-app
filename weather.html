<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç¾åœ¨åœ°ã®7æ—¥é–“å¤©æ°—äºˆå ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 24px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background: #7ebebe;
      color: #232323;
    }
    
    /* æ˜Ÿã®ç²’ãƒã‚¤ã‚º */
    body::after {
      content: "";
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background-image: radial-gradient(white 1px, transparent 1px);
      background-size: 3px 3px;
      opacity: 0.15;
      pointer-events: none;
    }
    
    h1 { margin-bottom: 10px; font-size: 1.3rem; color: #3a2a1a; }
    #weather-cards {
      display: flex; flex-wrap: wrap; gap: 16px; justify-content: center;
    }
    .card {
      width: 280px; border-radius: 12px; padding: 10px; background: #fff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.35);
    }
    .header {
      display: flex; align-items: center; margin-bottom: 6px;
    }
    .date { font-size: 1rem; font-weight: bold; }
    .icon { font-size: 2.2rem; margin-left: auto; margin-right: 12px; }
    .grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-size: 0.85rem;
    }
    .grid p { margin: 2px 0; line-height: 1.2; }
    .sun-row {
      grid-column: 1 / -1; text-align: center; margin-top: 4px; font-weight: bold;
    }
    .sunny   { background: linear-gradient(to bottom, #fff9c4, #ffd54f); }
    .cloudy  { background: linear-gradient(to bottom, #f0f0f0, #bdbdbd); }
    .rainy   { background: linear-gradient(to bottom, #4a90e2, #1c2f4a); color: #fff; }
    .snowy   { background: linear-gradient(to bottom, #f0f8ff, #e6e6fa); }
    .thunder { background: linear-gradient(to bottom, #6a5acd, #4b0082); color: #fff; }
    .unknown { background: linear-gradient(to bottom, #e0e0e0, #9e9e9e); color: #333; }
    @media (max-width: 640px) { .card { width: 92vw; } }
    
    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šï¼‰ */
    .top-right-button {
        position: absolute;
        top: 5px;
        right: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 6px 12px;
        font-size: 14px;
        cursor: pointer;
    }
    .top-right-button:hover {
        background-color: #0056b3;
    }
	/* 11/4 Top/Bottomãƒœã‚¿ãƒ³ */
	.bottom-button, .top-button {
	    position: fixed;
	    bottom: 20px;
	    left: 50%;
	    transform: translateX(-50%);
	    background: #007bff;
	    color: white;
	    border: none;
	    border-radius: 20px;
	    padding: 10px 20px;
	    font-size: 16px;
	    cursor: pointer;
	    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	    z-index: 9999;
	    display: none;
	}
	.bottom-button:hover, .top-button:hover {
	    background: #0056b3;
	}    
  </style>
</head>
<body>
  <button class="top-right-button" onclick="location.href='index.html'">æˆ»ã‚‹</button>

  <h1 id="title">ç¾åœ¨åœ°ã®7æ—¥é–“å¤©æ°—äºˆå ±</h1>
  <div id="weather-cards"></div>

  <script>
    const iconOf = code => {
      const map = {0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸŒ«ï¸",48:"ğŸŒ«ï¸",51:"ğŸŒ¦ï¸",61:"ğŸŒ§ï¸",71:"â„ï¸",80:"ğŸŒ§ï¸",95:"â›ˆï¸",99:"â›ˆï¸"};
      return map[code] || "ğŸŒ«ï¸";
    };
    const labelOf = code => {
      const map = {0:"å¿«æ™´",1:"æ™´ã‚Œ",2:"æ™´ã‚ŒãŒã¡",3:"æ›‡ã‚Š",45:"éœ§",48:"éœ§",51:"ã«ã‚ã‹é›¨",61:"é›¨",71:"é›ª",80:"é›¨",95:"é›·é›¨",99:"æ¿€ã—ã„é›·é›¨"};
      return map[code] || "ä¸æ˜";
    };
    const classOf = code => {
      if ([0,1].includes(code)) return "sunny";
      if ([2,3,45,48].includes(code)) return "cloudy";
      if ([51,61,80].includes(code)) return "rainy";
      if ([71].includes(code)) return "snowy";
      if ([95,99].includes(code)) return "thunder";
      return "unknown";
    };

    navigator.geolocation.getCurrentPosition(async (pos) => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
      const geoData = await geoRes.json();
      const placeName = geoData.address.city || geoData.address.town || geoData.address.village || "ç¾åœ¨åœ°";
      document.getElementById("title").textContent = `${placeName}ã®7æ—¥é–“å¤©æ°—äºˆå ±`;

      const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min,windspeed_10m_max,sunrise,sunset&hourly=weathercode,relativehumidity_2m,precipitation_probability&timezone=Asia%2FTokyo`);
      const data = await res.json();
      const days = data.daily;
      const hourly = data.hourly;
      const container = document.getElementById("weather-cards");

      for (let i = 0; i < days.time.length; i++) {
        const date = new Date(days.time[i]);
        const code = days.weathercode[i];
        const icon = iconOf(code);
        const bg = classOf(code);
        const max = days.temperature_2m_max[i];
        const min = days.temperature_2m_min[i];
        const wind = days.windspeed_10m_max[i];
        const sunrise = new Date(days.sunrise[i]).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});
        const sunset = new Date(days.sunset[i]).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});

        // åˆå‰ãƒ»åˆå¾Œã®ä»£è¡¨å¤©æ°—
        const dayKey = days.time[i];
        const indices = hourly.time.map((t, idx) => ({t, idx})).filter(o => o.t.startsWith(dayKey));
        const morning = indices.filter(o => new Date(o.t).getHours() < 12);
        const afternoon = indices.filter(o => new Date(o.t).getHours() >= 12);

        const mode = arr => {
          if (!arr.length) return null;
          const freq = {};
          arr.forEach(c => freq[c] = (freq[c]||0)+1);
          return +Object.keys(freq).reduce((a,b)=>freq[a]>freq[b]?a:b);
        };
        const morningCode = mode(morning.map(o=>hourly.weathercode[o.idx]));
        const afternoonCode = mode(afternoon.map(o=>hourly.weathercode[o.idx]));
        const morningLabel = morningCode!==null ? labelOf(morningCode) : "äºˆå ±æº–å‚™ä¸­";
        const afternoonLabel = afternoonCode!==null ? labelOf(afternoonCode) : "äºˆå ±æº–å‚™ä¸­";

        // æ¹¿åº¦ï¼ˆåˆå‰ãƒ»åˆå¾Œå¹³å‡ï¼‰
        const morningHum = morning.length ? Math.round(morning.map(o=>hourly.relativehumidity_2m[o.idx]).reduce((a,b)=>a+b,0)/morning.length) : "äºˆå ±æº–å‚™ä¸­";
        const afternoonHum = afternoon.length ? Math.round(afternoon.map(o=>hourly.relativehumidity_2m[o.idx]).reduce((a,b)=>a+b,0)/afternoon.length) : "äºˆå ±æº–å‚™ä¸­";

        // é™æ°´ç¢ºç‡ï¼ˆåˆå‰ãƒ»åˆå¾Œå¹³å‡ï¼‰
        const morningRain = morning.length ? Math.round(morning.map(o=>hourly.precipitation_probability[o.idx]).reduce((a,b)=>a+b,0)/morning.length) : "äºˆå ±æº–å‚™ä¸­";
        const afternoonRain = afternoon.length ? Math.round(afternoon.map(o=>hourly.precipitation_probability[o.idx]).reduce((a,b)=>a+b,0)/afternoon.length) : "äºˆå ±æº–å‚™ä¸­";

        const card = document.createElement("div");
        card.className = `card ${bg}`;
        card.innerHTML = `
          <div class="header">
            <span class="date">${date.toLocaleDateString("ja-JP",{weekday:"short",month:"numeric",day:"numeric"})}</span>
            <span class="icon">${icon}</span>
          </div>
          <div class="grid">
            <p>åˆå‰: ${morningLabel}</p>
            <p>åˆå¾Œ: ${afternoonLabel}</p>
            <p>æœ€é«˜: ${max}â„ƒ</p>
            <p>æœ€ä½: ${min}â„ƒ</p>
            <p>æ¹¿åº¦(åˆå‰): ${morningHum !== "äºˆå ±æº–å‚™ä¸­" ? morningHum+"%" : morningHum}</p>
            <p>æ¹¿åº¦(åˆå¾Œ): ${afternoonHum !== "äºˆå ±æº–å‚™ä¸­" ? afternoonHum+"%" : afternoonHum}</p>
            <p>é™æ°´ç¢ºç‡(åˆå‰): ${morningRain !== "äºˆå ±æº–å‚™ä¸­" ? morningRain+"%" : morningRain}</p>
            <p>é™æ°´ç¢ºç‡(åˆå¾Œ): ${afternoonRain !== "äºˆå ±æº–å‚™ä¸­" ? afternoonRain+"%" : afternoonRain}</p>
            <p>é¢¨é€Ÿ: ${wind}m/s</p>
            <p class="sun-row">æ—¥ã®å‡º: ${sunrise} ï¼ æ—¥æ²¡: ${sunset}</p>
          </div>
        `;
        container.appendChild(card);
      }
    }, (err) => {
	// ä½ç½®æƒ…å ±ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã®å‡¦ç†
	document.getElementById("title").textContent = "ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ";
	const container = document.getElementById("weather-cards");
	const card = document.createElement("div");
	card.className = "card unknown";
	card.innerHTML = `
	  <div class="header">
	    <span class="date">ã‚¨ãƒ©ãƒ¼</span>
	    <span class="icon">âš ï¸</span>
	  </div>
	  <div class="grid">
	    <p>ä½ç½®æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚</p>
	    <p>${err.message}</p>
	    <p>â€»åˆå›èµ·å‹•æ™‚ã«è¨±å¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ã‚¹ãƒãƒ›ã‚’å†èµ·å‹•ã—ã¦ã‚¢ãƒ—ãƒªã‚’é–‹ãã‹ã€è¨­å®šã‹ã‚‰ä½ç½®æƒ…å ±ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚</p>
	  </div>
	`;
	container.appendChild(card);
    });
    
  </script>
	    <button class="top-button" id="topBtn" onclick="scrollToTop()">Top</button>
		<button class="bottom-button" id="bottomBtn" onclick="scrollToBottom()">Bottom</button>
	    

  <script>
	    // ==========================================================
	    // â˜… ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³åˆ¶å¾¡ (Top/Bottom)
	    // ==========================================================

	    function scrollToTop() {
	      window.scrollTo({ top: 0, behavior: 'smooth' });
	    }

	    function scrollToBottom() {
	      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
	    }

	    function hideScrollButtons() {
	        document.getElementById("topBtn").style.display = "none";
	        document.getElementById("bottomBtn").style.display = "none";
	    }

		// ==========================================================
		// â˜… ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³åˆ¶å¾¡ã®ä¿®æ­£ç‰ˆ (Top/Bottom ç‹¬ç«‹åˆ¶å¾¡) 12/02
		// ==========================================================
		function showScrollButtonsIfPageLong() {
		    const topBtn = document.getElementById("topBtn");
		    const bottomBtn = document.getElementById("bottomBtn");
		    
		    const docHeight = document.body.scrollHeight;
		    const viewHeight = window.innerHeight;
		    const scrollY = window.scrollY;
		    
		    const scrollThreshold = 100; // ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã—ãã„å€¤ (px)
		    
		    // ãƒšãƒ¼ã‚¸ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã§ãªã‘ã‚Œã°ä¸¡æ–¹éè¡¨ç¤º
		    if (docHeight <= viewHeight + scrollThreshold) {
		        topBtn.style.display = "none";
		        bottomBtn.style.display = "none";
		        return;
		    }

		    // --- Topãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡ ---
		    // 100pxä»¥ä¸Šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸã‚‰Topãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
		    if (scrollY > scrollThreshold) {
		        topBtn.style.display = "block";
		    } else {
		        topBtn.style.display = "none";
		    }

		    // --- Bottomãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡ ---
		    // ãƒšãƒ¼ã‚¸ä¸‹ç«¯ã‹ã‚‰100pxæ‰‹å‰ã¾ã§Bottomãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
		    // (docHeight - viewHeight - scrollY) ã¯ã€æ®‹ã‚Šã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡
		    if (docHeight - viewHeight - scrollY > scrollThreshold) {
		        bottomBtn.style.display = "block";
		    } else {
		        bottomBtn.style.display = "none";
		    }
		}

	    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡
	    window.addEventListener("scroll", showScrollButtonsIfPageLong);
	    
	    // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚ãƒœã‚¿ãƒ³è¡¨ç¤ºã‚’ãƒã‚§ãƒƒã‚¯
	    window.addEventListener("load", showScrollButtonsIfPageLong);
	    
	    // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ã‚‚ãƒã‚§ãƒƒã‚¯ (ã‚¹ãƒãƒ›ã®å‘ãå¤‰æ›´ãªã©)
	    window.addEventListener("resize", showScrollButtonsIfPageLong);


	    // ==========================================================
	    // â˜… åˆæœŸåŒ–
	    // ==========================================================
	    // åˆæœŸåŒ–å‡¦ç†ã¯DOMContentLoadedãŒå®Œäº†ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹
	    document.addEventListener('DOMContentLoaded', () => {
	        showScrollButtonsIfPageLong();
	    });
	    
  </script>
  
  <footer>
    <br><br>
    Â© 20251203 ettomio
  </footer>
  <div style="height: 50px;"></div>
  
  </body>
</html>

