<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ©Ÿèƒ½é›»å“</title>
    <style>
        /* ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
        .calculator-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }
        .calculator {
            width: 300px;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
            background-color: #d0d0ff; /* èƒŒæ™¯è‰² */
        }
        .display {
            width: 100%;
            height: 40px;
            font-size: 1.7em;
            text-align: right;
            padding: 5px;
            margin-bottom: 10px;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #e8ffe8; /* èƒŒæ™¯è‰² */
        }
        
		header {
		  background: #8080ff;
		  color: white;
		  padding: 1em 0; /* ä¸Šä¸‹ã®ä½™ç™½ã‚’ã‚‚ã†å°‘ã—ã ã‘èª¿æ•´ */
		  text-align: center;
		  position: relative;
		}
		h1 {
		  font-size: 20px;
		  margin: 0;
		}    	
		        
        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        .button {
            width: 100%;
            height: 55px;
            font-size: 1.5em;
            cursor: pointer;
        }
        .history {
            margin-top: 10px;
            max-height: 180px;
            overflow-y: scroll;
            font-size: 0.9em;
            color: #666;
        }
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .history::-webkit-scrollbar {
            width: 16px; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®å¹… */
        }
        .history::-webkit-scrollbar-thumb {
            background-color: #888; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®è‰² */
            border-radius: 8px; /* ä¸¸ã¿ã‚’è¿½åŠ  */
            border: 4px solid transparent; /* å‘¨ã‚Šã«ä½™ç™½ã‚’è¿½åŠ  */
            background-clip: content-box; /* èƒŒæ™¯ã®åˆ‡ã‚Šå–ã‚Š */
        }
        .history::-webkit-scrollbar-thumb:hover {
            background-color: #555; /* ãƒ›ãƒãƒ¼æ™‚ã®è‰² */
        }
        .history::-webkit-scrollbar-track {
            background-color: #ccc; /* èƒŒæ™¯ã®è‰² */
            border-radius: 8px; /* ä¸¸ã¿ã‚’è¿½åŠ  */
        }
        .history-item {
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        body {
            background-color: #cbe4e4; /* èƒŒæ™¯è‰² */
        }

        button {
            font-size: 18px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
            padding: 3px 10px; /* å†…å´ä½™ç™½ */
            margin: 1px; /* å‘¨å›²ã®ä½™ç™½ */
            border-radius: 5px; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
            background-color: #ccffff; /* èƒŒæ™¯è‰² */
            color: black; /* æ–‡å­—è‰² */
    		border: 1px solid black; /* æ ç·šã‚’è¡¨ç¤º */
            cursor: pointer; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ã«å¤‰æ›´ */
        }

		.history-text {
		    color: blue;
		    font-weight: bold;
		}

	    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ 5/6 */
	    .top-right-button {
          width: auto; /* ãƒœã‚¿ãƒ³ã®å¹…ã‚’è‡ªå‹•èª¿æ•´ */
	      position: absolute;
	      top: 10px;
	      right: 10px;
	      background-color: #ccffff;
	      color: black;
	      border-radius: 20px;
	      padding: 6px 12px;
	      font-size: 14px;
    	  border: 1px solid black; /* æ ç·šã‚’è¡¨ç¤º */	      
	      cursor: pointer;
	    }
	    .top-right-button:hover {
	      background-color: #f4f4f4;
	    }

	    footer {
	      text-align: center;
	      padding: 12px;
	    }
	    
    </style>
</head>
<body>

  	<header>
    <!-- Homeã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ 5/6 -->
	    <button class="top-right-button" onclick="location.href='index.html'">æˆ»ã‚‹</button>
	    <h1>ğŸ”¢  ç°¡æ˜“é›»å“</h1>
  	</header>
  	
<div class="calculator-container">
    <div class="calculator">
        <input type="text" id="display" class="display" readonly>
        <div class="buttons">
            <button class="button" onclick="clearDisplay()">C</button>
            <button class="button" onclick="backspace()">â†</button>
            <button class="button" onclick="setOperator('**')">xÂ²</button>
            <button class="button" onclick="setOperator('sqrt')">âˆš</button>

            <button class="button" onclick="appendNumber('7')">7</button>
            <button class="button" onclick="appendNumber('8')">8</button>
            <button class="button" onclick="appendNumber('9')">9</button>
            <button class="button" onclick="setOperator('/')">Ã·</button>

            <button class="button" onclick="appendNumber('4')">4</button>
            <button class="button" onclick="appendNumber('5')">5</button>
            <button class="button" onclick="appendNumber('6')">6</button>
            <button class="button" onclick="setOperator('*')">Ã—</button>

            <button class="button" onclick="appendNumber('1')">1</button>
            <button class="button" onclick="appendNumber('2')">2</button>
            <button class="button" onclick="appendNumber('3')">3</button>
            <button class="button" onclick="setOperator('-')">-</button>

            <button class="button" onclick="appendNumber('0')">0</button>
            <button class="button" onclick="appendDecimal()">.</button>
            <button class="button" onclick="calculate()">=</button>
            <button class="button" onclick="setOperator('+')">+</button>
        </div>
        <div class="history" id="history"></div>
    </div>
		  <img src="soroban.png" alt="ã‚µãƒ³ãƒ—ãƒ«ç”»åƒ">
</div>

<script>
    const display = document.getElementById('display');
    const history = document.getElementById('history');

    let currentInput = '';
    let previousValue = null;
    let internalValue = null;
    let operator = '';
    let decimalAdded = false;

    const DISPLAY_PRECISION = 12;

    /* ---------- è¡¨ç¤ºå°‚ç”¨ä¸¸ã‚ ---------- */
    function formatDisplay(value) {
        if (!isFinite(value)) return 'Error';
        return Number(value.toFixed(DISPLAY_PRECISION)).toString();
    }

    /* ---------- å…¥åŠ› ---------- */
    function appendNumber(num) {
        currentInput += num;
        display.value = currentInput;
    }

    function appendDecimal() {
        if (!decimalAdded) {
            currentInput += '.';
            display.value = currentInput;
            decimalAdded = true;
        }
    }

    /* ---------- æ¼”ç®—å­ ---------- */
    function setOperator(op) {
        if (currentInput === '' && internalValue === null) return;

        if (op === 'sqrt') {
            const value = internalValue ?? parseFloat(currentInput);
            if (value < 0) {
                display.value = 'Error';
                return;
            }
            internalValue = Math.sqrt(value);
            currentInput = formatDisplay(internalValue);
            display.value = currentInput;
            addHistory(`âˆš${formatDisplay(value)} = ${currentInput}`);
            decimalAdded = currentInput.includes('.');
            return;
        }

        if (op === '**') {
            const value = internalValue ?? parseFloat(currentInput);
            internalValue = value * value;
            currentInput = formatDisplay(internalValue);
            display.value = currentInput;
            addHistory(`${formatDisplay(value)}Â² = ${currentInput}`);
            decimalAdded = currentInput.includes('.');
            return;
        }

        if (internalValue === null) {
            internalValue = parseFloat(currentInput);
        }

        operator = op;
        previousValue = internalValue;
        currentInput = '';
        decimalAdded = false;
    }

    /* ---------- è¨ˆç®— ---------- */
    function calculate() {
        if (operator === '' || currentInput === '') return;

        const currentValue = parseFloat(currentInput);
        let result;

        switch (operator) {
            case '+': result = previousValue + currentValue; break;
            case '-': result = previousValue - currentValue; break;
            case '*': result = previousValue * currentValue; break;
            case '/':
                if (currentValue === 0) {
                    display.value = 'Error';
                    return;
                }
                result = previousValue / currentValue;
                break;
            default:
                return;
        }

        internalValue = result;
        const displayResult = formatDisplay(result);
        display.value = displayResult;

        addHistory(`${formatDisplay(previousValue)} ${operator} ${formatDisplay(currentValue)} = ${displayResult}`);

        currentInput = displayResult;
        operator = '';
        previousValue = null;
        decimalAdded = currentInput.includes('.');
    }

    /* ---------- æ“ä½œ ---------- */
    function clearDisplay() {
        currentInput = '';
        previousValue = null;
        internalValue = null;
        operator = '';
        decimalAdded = false;
        display.value = '';
    }

    function backspace() {
        currentInput = currentInput.slice(0, -1);
        display.value = currentInput;
        decimalAdded = currentInput.includes('.');
    }

    /* ---------- å±¥æ­´ ---------- */
    function addHistory(text) {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `<span class="history-text">${text}</span>`;
        history.appendChild(div);
        history.scrollTop = history.scrollHeight;
    }
</script>
  <footer>
    Â© 20260111 ettomio
  </footer>
  
</body>
</html>
