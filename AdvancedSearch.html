<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜æ©Ÿèƒ½æ¤œç´¢</title>
    <link rel="stylesheet" href="styles.css">
    
	<style>    
	/* åŸºæœ¬ã®ã‚¹ã‚¿ã‚¤ãƒ« */
	body {
	    font-family: Arial, sans-serif;
	    font-size: 15px;
	    margin: 7px;
	    background-color: #ffffc4;
	}

	.container {
	    display: flex;
	    flex-direction: column;
	    align-items: center;
	    padding: 15px;
	    max-width: 600px;
	    margin: auto;
	    background-color: #e1e1ff;
	}

	header {
	    background:  #6c6cff;
	    color: white;
	    padding: 1em 0; /* ä¸Šä¸‹ã®ä½™ç™½ã‚’ã‚‚ã†å°‘ã—ã ã‘èª¿æ•´ */
	    text-align: center;
	    position: relative;
	}
	h1 {
	    font-size: 20px;
	    margin: 0;
	}    	 	 	 	 	 	 

	h2 {
	    font-size: 15px;
	}    	
	
	/* å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ */
	input[type="text"] {
	    all: unset;
	    display: block;
	    width: 100%;
	    height: 40px;
	    font-size: 16px;
	    box-sizing: border-box;
	    background-color: #ffffff; /* èƒŒæ™¯ã‚’ç™½ */
	    color: #000000; /* æ–‡å­—è‰²ã‚’é»’ */
	    border: 1px solid #0000ff; /* é’ã„æ ç·š */
	    padding: 5px; /* å†…å´ã®ä½™ç™½ */
	    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* è»½ã„å½± */
	}

	input[type="text"]:focus {
	    border-color: #ff0000; /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«èµ¤ã„æ ç·š */
	    outline: none; /* ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³å‰Šé™¤ */
	}

	/* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
	.table-container {
	    width: 100%;
	    overflow-x: auto;
	    margin-top: 20px;
	}

	table {
	    width: 100%;
	    border-collapse: collapse;
	}

	th, td {
	    border: 1px solid #ddd;
	    padding: 8px;
	    text-align: left;
	    word-wrap: break-word;
	    white-space: pre-wrap;
	}

	th.keyword-column, td.keyword-column {
	    width: 20%;
	    max-width: 6ch; /* ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®æ–‡å­—æ•°åˆ¶é™ */
	}

	th.content-column, td.content-column {
	    width: 60%;
	    max-width: 10ch; /* å†…å®¹ã®æ–‡å­—æ•°åˆ¶é™ */
	}

	th.actions-column, td.actions-column {
	    width: 20%;
	    text-align: center;	 	
	}

	td.actions-column button {
	    display: inline-block; /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã§ä¸­å¤®å¯„ã› */
	}
	
	/* è©³ç´°è¡¨ç¤º */
	#fullContent {
	    width: 100%;
	    border: 1px solid #ddd;
	    padding: 10px;
	    margin-top: 20px;
	    background-color: #ffffff; /* èƒŒæ™¯ã‚’ç™½ */
	    white-space: pre-wrap;
	}

	/* ãƒœã‚¿ãƒ³
	button {
	    font-size: 14px;
	    padding: 5px 10px;
	    margin-top: 5px;
	    margin-bottom: 3px;	    
	    border-radius: 5px;
	    background-color: #ffd5ea;
	    color: black;
	    border: 1px solid #0000ff;
	    cursor: pointer;
	} */

	.container button { 
	    font-size: 14px;
	    padding: 3px 10px;
	    margin-top: 3px;
	    margin-bottom: 0px;	    
	    border-radius: 5px;
	    background-color: #ffffff;
	    color: black;
	    border: 1px solid #0000ff;
	    cursor: pointer;
	}
		
	.closeButton {
	    font-size: 14px;
	    padding: 5px 10px;
	    margin: 0px;
	    border-radius: 5px;
	    background-color: #e5e5e5;
	    color: black;
	    border: 1px solid #0000ff;
	    cursor: pointer;
	}
    .btn-show-text {  /* 3/15ã«è¿½åŠ  */
        font-size: 14px;
        padding: 0px 2px;
        padding: 3px 5px; /* ãƒœã‚¿ãƒ³ã®ä½™ç™½ã‚’èª¿æ•´ */
	    margin-top: 2px;        
        background-color: #ffffff;
        color: black;
        border: 1px solid #0000ff;
        border-radius: 5px;          
        cursor: pointer;
        min-width: 60px;   /* æœ€å°å¹…ã‚’è¨­å®š */
        display: inline-block; /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
    }
	/* è©³ç´°ã‚³ãƒ³ãƒ†ãƒŠ */
	.detail-container {
	    background-color: #f2f2f2;
	    word-break: break-all;
	}

	button, a {
	    cursor: pointer; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ‰‹ã®å½¢ã« */
	}
	#saveButton, #closeButton {
	    cursor: pointer; /* ã‚«ãƒ¼ã‚½ãƒ«ã‚’æ‰‹ã®å½¢ã« */
	}

	/* ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã«ã‚ˆã‚‹ã‚¹ãƒãƒ›å¯¾å¿œ */
	@media only screen and (max-width: 600px) {
	    td.keyword-column {
	        max-width: 6ch; /* ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ—ã®å¹…åˆ¶é™ */
	    }
	    td.content-column {
	        max-width: 10ch; /* å†…å®¹åˆ—ã®å¹…åˆ¶é™ */
	    }
	    table, th, td {
	        font-size: 16px; /* ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ */
	    }
	    #keywordInput {
	        height: 30px; /* ã‚¹ãƒãƒ›ç”¨ã®é«˜ã• */
	    }
	}
	
    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ 5/6 */
    .top-right-button {
      width: auto; /* ãƒœã‚¿ãƒ³ã®å¹…ã‚’è‡ªå‹•èª¿æ•´ */
      position: absolute;
      top: 5px;
      right: 10px;
      background-color: #00bf00;
      color: #ffffff;
      border-radius: 20px;
      padding: 6px 12px;
      font-size: 14px;
	  border: 1px solid black; /* æ ç·šã‚’è¡¨ç¤º */	 	 
      cursor: pointer;
    }
    .top-right-button:hover {
      background-color: #cae4ff;
    }

	/* 8/11 è¿½åŠ  */	
	#voiceButton {
	    color: #4d0000;
	    background-color: #c8ffe3;
	    border-radius: 5px;
	    border: 1px solid #0000ff;
	    margin-bottom: 8px; 	    
	}

	@keyframes blink {
	    0% { opacity: 1; }
	    50% { opacity: 0.3; }
	    100% { opacity: 1; }
	}

	.blinking {
	    animation: blink 1s infinite;
	}

	#voiceButton.recording {
	    color: red !important;
	    background-color: #ffd0d0 !important;
	}

	/* ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ */
	.custom-alert { 
	    position: fixed; 
	    top: 20px; 
	    left: 50%; 
	    transform: translateX(-50%); 
	    background-color: #333; 
	    color: white; 
	    padding: 15px 25px; 
	    border-radius: 5px; 
	    box-shadow: 0 2px 10px rgba(0,0,0,0.2); 
	    z-index: 1000; 
	    font-size: 1em; 
	}

	/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼‰ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« 10/22 Gemini */
	.modal {
	    display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
	    position: fixed;
	    z-index: 1000; /* ä»–ã®è¦ç´ ã‚ˆã‚Šæ‰‹å‰ã«è¡¨ç¤º */
	    left: 0;
	    top: 0;
	    width: 100%;
	    height: 100%;
	    overflow: auto;
	    background-color: rgba(0,0,0,0.4); /* èƒŒæ™¯ã‚’æš—ãã™ã‚‹ */
	}

	/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ä¸­èº« */
	.modal-content {
	    background-color: #fefefe;
	    margin: 15% auto; /* ç”»é¢ä¸­å¤®ã«é…ç½® */
	    padding: 20px;
	    border: 1px solid #888;
	    width: 80%;
	    max-width: 400px;
	    border-radius: 8px;
	    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
	    text-align: center;
	}

	.bottom-button, .top-button {
	    position: fixed;
	    bottom: 20px;
	    left: 50%;
	    transform: translateX(-50%);
	    background: #007bff !important;
	    color: white !important;
	    border: none !important;
	    border-radius: 20px;
	    padding: 8px 20px!important;
	    font-size: 16px!important;
	    cursor: pointer;
	    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	    z-index: 9999;
	    display: none;
	}
	.bottom-button:hover, .top-button:hover {
	    background: #0056b3;
	}

    footer {
      text-align: center;
      padding: 12px;
      font-size: 15px;	
      color: #b87272;                
    }	

	.button-row {
	    display: flex;
	    gap: 10px; /* ãƒœã‚¿ãƒ³ã®é–“ã«ä½™ç™½ã‚’ã¤ã‘ã‚‹ */
	    margin-top: 10px;
	    flex-wrap: wrap; /* ç”»é¢ãŒç‹­ã„ã¨ãã¯æŠ˜ã‚Šè¿”ã™ */
	}

	/* å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
	#saveButton, #closeButton {
	    display: none;
	    font-size: 14px;
	    padding: 5px 10px;
	    width: 110px;
	    border-radius: 5px;
	    border: 1px solid #0000ff;
	    cursor: pointer;
	    box-sizing: border-box;
	    text-align: center;
	    white-space: nowrap;
	}

	/* å€‹åˆ¥ã®è‰²ã ã‘åˆ†ã‘ã‚‹ */
	#saveButton {
	    background-color: #ffe7d9;
	    color: black;
	}

	#closeButton {
	    background-color: #e5e5e5;
	    color: black;
	}
	    			
	</style>
	
</head>

<body>
    <header>
        <button class="top-right-button" onclick="goBack()">æˆ»ã‚‹</button>
        
        <h1>ğŸ“š é«˜æ©Ÿèƒ½æ¤œç´¢</h1>
    </header>

    <div class="container">

        <div>
            <label for="keywordInput">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</label>
            <button id="voiceButton" onclick="startVoiceInput()">ğŸ¤ éŸ³å£°å…¥åŠ›</button>
            <input type="text" id="keywordInput" oninput="searchMemos()" placeholder="æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
        </div>

        <div id="searchResults" class="table-container"></div>

		<div id="fullContent" class="detail-container" contenteditable="true"></div>

		<div class="button-row">
		    <button id="saveButton" onclick="saveChanges()">ä¿®æ­£ã—ã¦ä¿å­˜</button>
		    <button id="closeButton" onclick="closeFullContent()">è©³ç´°ã‚’é–‰ã˜ã‚‹</button>
		</div>

        <script>
            // â˜…â˜…â˜… å¤‰æ•°å®£è¨€ã‚’ã“ã“ã«çµ±ä¸€ã—ã€é‡è¤‡ã‚’è§£æ¶ˆã—ã¾ã™ â˜…â˜…â˜…
            let recognition = null; // Web Speech APIç”¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            let isListening = false;
            let currentKey = null; // ç¾åœ¨è¡¨ç¤ºã—ã¦ã„ã‚‹keyã‚’ä¿æŒ
            
            // --- UI/UX è£œåŠ©é–¢æ•° ---

            // ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
            function showCustomAlert(message) {
                const alertContainer = document.createElement('div');
                alertContainer.className = 'custom-alert';
                alertContainer.textContent = message;

                document.body.appendChild(alertContainer);

                setTimeout(() => {
                    document.body.removeChild(alertContainer);
                }, 2000);
            }

            // ãƒœã‚¿ãƒ³è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
            function toggleVoiceButton(isClearMode) {
                const voiceButton = document.getElementById('voiceButton');
                if (isClearMode) {
                    voiceButton.textContent = 'âŒ ã‚¯ãƒªã‚¢';
                    voiceButton.onclick = clearVoiceInput;
                    voiceButton.classList.remove("blinking", "recording");
                } else {
                    voiceButton.textContent = 'ğŸ¤ éŸ³å£°å…¥åŠ›';
                    voiceButton.onclick = startVoiceInput;
                    voiceButton.classList.remove("blinking", "recording");
                }
            }

            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢ã—ã¦å…¨ãƒªã‚¹ãƒˆè¡¨ç¤ºã«æˆ»ã™é–¢æ•°
            function clearVoiceInput() {
                document.getElementById('keywordInput').value = '';
                searchMemos();
                toggleVoiceButton(false); // ã€ŒéŸ³å£°å…¥åŠ›ã€ãƒœã‚¿ãƒ³ã«æˆ»ã™
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå€™è£œã‚’é¸æŠã—ãŸã¨ãã®å‡¦ç†
            function selectAlternative(transcript) {
                document.getElementById('keywordInput').value = transcript;
                document.getElementById('alternativesModal').style.display = 'none';
                searchMemos();
                toggleVoiceButton(true); 
            }

            // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã®å‡¦ç†
            function closeAlternativesModal() {
                document.getElementById('alternativesModal').style.display = 'none';
            }

            // ------------------------------------------------
            // â˜…â˜…â˜… ãƒ¡ã‚¤ãƒ³: éŸ³å£°èªè­˜ã¨ç’°å¢ƒã®åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯ â˜…â˜…â˜…
            // ------------------------------------------------

            // ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã‹ã‚‰çµæœã‚’å—ã‘å–ã‚‹é–¢æ•° (Kotlinã‹ã‚‰å‘¼ã°ã‚Œã‚‹)
            // WebView(ã‚¢ãƒ—ãƒª)ç’°å¢ƒã§ã®ã¿ä½¿ç”¨
            function receiveNativeAlternatives(alternatives) {
                const voiceButton = document.getElementById('voiceButton');
                const alternativesContainer = document.getElementById('alternativeButtons');
                alternativesContainer.innerHTML = ''; 
                
                isListening = false;
                voiceButton.classList.remove("blinking", "recording");

                if (alternatives.length === 0) {
                    showCustomAlert('éŸ³å£°èªè­˜ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
                    toggleVoiceButton(false);
                    return;
                }

                // å€™è£œã‚’ãƒœã‚¿ãƒ³ã¨ã—ã¦ä½œæˆã—ã€ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
                alternatives.forEach(transcript => {
                    const button = document.createElement('button');
                    button.textContent = transcript;
                    button.onclick = () => selectAlternative(transcript); 
                    alternativesContainer.appendChild(button);
                });
                
                document.getElementById('alternativesModal').style.display = 'block';
            }
            
            // Web Speech APIã®åˆæœŸåŒ–ã¨å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ (ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§ã®ã¿ä½¿ç”¨)
            function startWebSpeechAPI() {
                if (!recognition) {
                    if ('webkitSpeechRecognition' in window) {
                        recognition = new webkitSpeechRecognition();
                    } else if ('SpeechRecognition' in window) {
                        recognition = new SpeechRecognition();
                    } else {
                        recognition = null;
                        document.getElementById('voiceButton').style.display = "none";
                        showCustomAlert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯éŸ³å£°å…¥åŠ›ãŒä½¿ãˆã¾ã›ã‚“ã€‚');
                        return;
                    }

                    recognition.lang = 'ja-JP';
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 3; 
                    
                    recognition.onresult = function(event) {
                        const result = event.results[0];
                        const alternativesContainer = document.getElementById('alternativeButtons');
                        alternativesContainer.innerHTML = ''; 
                        
                        // Web Speech APIã®çµæœã‚’å‡¦ç†
                        const alternatives = Array.from(result).map(r => r.transcript);

                        if (alternatives.length === 0) {
                            recognition.onerror({ error: 'no-speech' });
                            return;
                        }
                        
                        // å€™è£œã‚’ãƒœã‚¿ãƒ³ã¨ã—ã¦ä½œæˆã—ã€ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
                        alternatives.forEach(transcript => {
                            const button = document.createElement('button');
                            button.textContent = transcript;
                            button.onclick = () => selectAlternative(transcript);
                            alternativesContainer.appendChild(button);
                        });
                        
                        document.getElementById('alternativesModal').style.display = 'block';
                        
                        // UIãƒªã‚»ãƒƒãƒˆ
                        toggleVoiceButton(false);
                        isListening = false;
                    };

                    recognition.onerror = function(event) {
                        // ãƒ–ãƒ©ã‚¦ã‚¶å›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ†ã‹ã‚Šã‚„ã™ã
                        console.error('Web Speech API Error:', event.error);
                        showCustomAlert('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã”ç¢ºèªãã ã•ã„ã€‚');
                        toggleVoiceButton(false);
                        isListening = false;
                    };
                    
                    recognition.onend = function() {
                        isListening = false;
                        document.getElementById('voiceButton').classList.remove("blinking", "recording");
                    };
                }

                if (recognition && !isListening) { 
                    recognition.start();
                    isListening = true;
                    document.getElementById('voiceButton').classList.add("blinking", "recording");
                }
            }


            // éŸ³å£°å…¥åŠ›ã‚’é–‹å§‹ã™ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•° (HTMLã®onclickã‹ã‚‰å‘¼ã°ã‚Œã‚‹)
            function startVoiceInput() {
                const voiceButton = document.getElementById('voiceButton');
                
                // 1. ã€ã‚¢ãƒ—ãƒªç’°å¢ƒåˆ¤å®šã€‘: Androidã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã‹
                if (typeof Android !== 'undefined' && Android.startVoiceRecognition) {
                    // â˜…ã‚¢ãƒ—ãƒª(WebView)ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆ: ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã™
                    Android.startVoiceRecognition();
                    isListening = true; 
                    voiceButton.classList.add("blinking", "recording");
                } 
                // 2. ã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒåˆ¤å®šã€‘: Web Speech APIã®æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã‹
                else if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    // â˜…ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹å ´åˆ: Web Speech APIã‚’ä½¿ç”¨
                    startWebSpeechAPI();
                }
                // 3. ã€éå¯¾å¿œç’°å¢ƒã€‘
                else {
                    voiceButton.style.display = "none";
                    showCustomAlert('ã“ã®ç«¯æœ«ã§ã¯éŸ³å£°å…¥åŠ›ãŒä½¿ãˆã¾ã›ã‚“ã€‚æ‰‹å‹•å…¥åŠ›ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                }
            }
            
            // ------------------------------------------------
            // --- æ—¢å­˜ã®æ¤œç´¢ãƒ»è©³ç´°ãƒ­ã‚¸ãƒƒã‚¯ ---
            // ------------------------------------------------

            // URLã‚’ãƒªãƒ³ã‚¯ã«å¤‰æ›ã™ã‚‹é–¢æ•°
            function makeUrlsClickable(text) {
                const urlPattern = /(https?:\/\/[^\s]+)/g;
                return text.replace(urlPattern, '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>');
            }

            // è©³ç´°ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
            function displayFullContent(content, key) {
                const fullContentDiv = document.getElementById('fullContent');
                const saveButton = document.getElementById('saveButton');
                const closeButton = document.getElementById('closeButton');

                currentKey = key;
                fullContentDiv.innerHTML = makeUrlsClickable(content);
                fullContentDiv.contentEditable = true;
                fullContentDiv.style.display = 'block';
                saveButton.style.display = 'block';
                closeButton.style.display = 'block';
                fullContentDiv.scrollIntoView({ behavior: 'smooth' });

                fullContentDiv.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        e.preventDefault();
                        window.open(e.target.href, '_blank', 'noopener,noreferrer');
                    }
                });
            }

            // è©³ç´°ã‚’é–‰ã˜ã‚‹é–¢æ•°
            function closeFullContent() {
                document.getElementById('fullContent').style.display = 'none';
                document.getElementById('saveButton').style.display = 'none';
                document.getElementById('closeButton').style.display = 'none';
                currentKey = null;
                scrollToTop()
            }

            // ä¿®æ­£å†…å®¹ã‚’ä¿å­˜ã™ã‚‹é–¢æ•°
            function saveChanges() {
                const fullContentDiv = document.getElementById('fullContent');
                // HTMLè¦ç´ ã®å†…å®¹ã‚’ãã®ã¾ã¾å–å¾—ã—ã€URLã¨ã—ã¦ä¿å­˜ã•ã‚Œãªã„ã‚ˆã†ã«ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã‚’æ ¼ç´
                const newContent = fullContentDiv.innerText;

                if (currentKey) {
                    localStorage.setItem(currentKey, newContent);
                    alert('å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
                    searchMemos();
                } else {
                    alert('ä¿å­˜ã™ã‚‹å†…å®¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                }
            }

            // ãƒ¡ãƒ¢ã®æ¤œç´¢ã¨è¡¨ç¤ºã‚’è¡Œã†é–¢æ•°
            function searchMemos() {
            	// â˜…â˜…â˜… ã“ã®è¡Œã‚’å…ˆé ­ã«è¿½åŠ ã—ã¾ã™ 11/8 â˜…â˜…â˜…
    			closeFullContent();
    			
                const keyword = document.getElementById('keywordInput').value;
                const keys = Object.keys(localStorage).filter(key => key !== 'searchKeyword');
                const searchResults = keys.filter(key => {
                    const content = localStorage.getItem(key);
                    return content && content.includes(keyword); // contentãŒnullã§ãªã„ã“ã¨ã‚’ç¢ºèª
                });

                searchResults.sort((a, b) => a.localeCompare(b));

                const searchResultsList = document.getElementById('searchResults');
                searchResultsList.innerHTML = '';

                if (searchResults.length === 0 && keyword.length > 0) {
                     searchResultsList.innerHTML = '<p style="text-align: center; color: #888;">ä¸€è‡´ã™ã‚‹çµæœã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                     return;
                }


                const table = document.createElement('table');
                const headerRow = document.createElement('tr');
                const headers = ['key', 'å†…å®¹', 'æ“ä½œ'];
                const classNames = ['keyword-column', 'content-column', 'actions-column'];
                
                headers.forEach((text, index) => {
                    const th = document.createElement('th');
                    th.classList.add(classNames[index]);
                    th.textContent = text;
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                searchResults.forEach(key => {
                    const row = document.createElement('tr');
                    const content = localStorage.getItem(key) || '';
                    
                    const keywordCell = document.createElement('td');
                    keywordCell.classList.add('keyword-column');
                    keywordCell.textContent = key.slice(0, 10);
                    
                    const contentCell = document.createElement('td');
                    contentCell.classList.add('content-column');
                    contentCell.textContent = content.slice(0, 30) + (content.length > 30 ? '...' : '');

                    const actionsCell = document.createElement('td');
                    actionsCell.classList.add('actions-column');
                    
					const viewButton = document.createElement('button');
					viewButton.textContent = 'è¡¨ç¤º';
					viewButton.classList.add('btn-show-text'); 
					viewButton.onclick = () => displayFullContent(content, key);

					const deleteButton = document.createElement('button');
					deleteButton.textContent = 'æ¶ˆå»';
					deleteButton.classList.add('btn-show-text');
					deleteButton.onclick = () => {
					    const confirmed = confirm("ã“ã®é …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ");
					    if (confirmed) {
					        localStorage.removeItem(key);
					        alert("å‰Šé™¤ã—ã¾ã—ãŸ");
					        searchMemos(); // å†æç”»
					    }
					};

					actionsCell.appendChild(viewButton);
					actionsCell.appendChild(document.createElement('br')); // è¡¨ç¤ºã¨æ¶ˆå»ã®é–“ã«æ”¹è¡Œ
					actionsCell.appendChild(deleteButton);

                    row.appendChild(keywordCell);
                    row.appendChild(contentCell);
                    row.appendChild(actionsCell);
                    table.appendChild(row);
                });

                searchResultsList.appendChild(table);
            }

            // DOMèª­ã¿è¾¼ã¿å¾Œã®åˆæœŸåŒ–
            document.addEventListener('DOMContentLoaded', function () {
                const voiceButton = document.getElementById('voiceButton');
                const keywordInput = document.getElementById('keywordInput');

                // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã«å‡¦ç†ã‚’å‰²ã‚Šå½“ã¦ã‚‹
                document.getElementById('closeModalButton').onclick = closeAlternativesModal;
                
                // åˆæœŸã®éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’è¨­å®š
                if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) && !(typeof Android !== 'undefined' && Android.startVoiceRecognition)) {
                    voiceButton.style.display = "none";
                    showCustomAlert('ã“ã®ç«¯æœ«ã§ã¯éŸ³å£°å…¥åŠ›ãŒä½¿ãˆã¾ã›ã‚“ã€‚æ‰‹å‹•å…¥åŠ›ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                } else {
                    toggleVoiceButton(false);
                }

                // æ‰‹å‹•å…¥åŠ›ãŒå§‹ã¾ã£ãŸã‚‰ã€ŒâŒ ã‚¯ãƒªã‚¢ã€ãƒœã‚¿ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆ
                keywordInput.addEventListener('input', function () {
                    if (this.value.trim() !== '') {
                        voiceButton.style.display = "inline-block";
                        toggleVoiceButton(true);
                    } else {
                        toggleVoiceButton(false);
                    }
                });
                
                // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–æ¤œç´¢ã‚’å®Ÿè¡Œ
                searchMemos();
            });

		</script>

	    <button class="top-button" id="topBtn" onclick="scrollToTop()">Top</button>
		<button class="bottom-button" id="bottomBtn" onclick="scrollToBottom()">Bottom</button>
	    <div style="height: 30px;"></div>
	    
	    <script>
	    // ==========================================================
	    // â˜… ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³åˆ¶å¾¡ (Top/Bottom)
	    // ==========================================================

	    function scrollToTop() {
	      window.scrollTo({ top: 0, behavior: 'smooth' });
	    }

	    function scrollToBottom() {
	      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
	    }

	    function hideScrollButtons() {
	        document.getElementById("topBtn").style.display = "none";
	        document.getElementById("bottomBtn").style.display = "none";
	    }

	    // â˜… ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³åˆ¶å¾¡ (Top/Bottom) 11/6
	function showScrollButtonsIfPageLong() {
	    const topBtn = document.getElementById("topBtn");
	    const bottomBtn = document.getElementById("bottomBtn");
	    
	    // ãƒšãƒ¼ã‚¸ãŒååˆ†ã«é•·ã„ã‹ãƒã‚§ãƒƒã‚¯ (ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒçŸ­ã„å ´åˆã¯ãƒœã‚¿ãƒ³ä¸è¦)
	    const scrollThreshold = 300;
	    const isScrollable = document.body.scrollHeight > window.innerHeight + scrollThreshold; 

	    if (!isScrollable) {
	        hideScrollButtons();
	        return;
	    }

	    // ãƒšãƒ¼ã‚¸ãŒé•·ã„å ´åˆã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã«ã‚ˆã‚‹åˆ¶å¾¡
	    const scrollY = window.scrollY;
	    const docHeight = document.body.scrollHeight;
	    const viewHeight = window.innerHeight;
	    const bottomMargin = docHeight - viewHeight - scrollY; // ç”»é¢ä¸‹ç«¯ã‹ã‚‰ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸‹ç«¯ã¾ã§ã®è·é›¢
	    
	    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã®åˆ¤å®š
	    if (scrollY > scrollThreshold) {
	        // [ã‚±ãƒ¼ã‚¹1] ã‚ã‚‹ç¨‹åº¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸ -> Topãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º (Bottomãƒœã‚¿ãƒ³ã¯éè¡¨ç¤º)
	        topBtn.style.display = "block";
	        bottomBtn.style.display = "none";
	    } else if (scrollY === 0 && bottomMargin > scrollThreshold) {
	        // [ã‚±ãƒ¼ã‚¹2 - ä¿®æ­£ç®‡æ‰€] ãƒšãƒ¼ã‚¸æœ€ä¸Šéƒ¨ï¼ˆscrollY=0ï¼‰ã«ã„ã‚‹å ´åˆ -> Bottomãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "none"; 
	    } else if (bottomMargin > scrollThreshold) {
	        // [ã‚±ãƒ¼ã‚¹3] ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«ã„ã‚‹ãŒã€åº•éƒ¨ã¯ã¾ã é ã„ -> Bottomãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
	        // ãŸã ã—ã€ã“ã®else ifã«åˆ°é”ã™ã‚‹ã®ã¯ scrollY > 0 ã®æ™‚ã®ã¿ (ã‚±ãƒ¼ã‚¹2ã§å¼¾ã‹ã‚Œã‚‹ãŸã‚)
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "block";
	    } else {
	        // [ã‚±ãƒ¼ã‚¹4] ãƒšãƒ¼ã‚¸ã®ä¸‹ç«¯è¿‘ãã«ã„ã‚‹
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "none";
	    }
	}
	
	    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡
	    window.addEventListener("scroll", showScrollButtonsIfPageLong);
	    
	    // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚ãƒœã‚¿ãƒ³è¡¨ç¤ºã‚’ãƒã‚§ãƒƒã‚¯
	    window.addEventListener("load", showScrollButtonsIfPageLong);
	    
	    // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ã‚‚ãƒã‚§ãƒƒã‚¯ (ã‚¹ãƒãƒ›ã®å‘ãå¤‰æ›´ãªã©)
	    window.addEventListener("resize", showScrollButtonsIfPageLong);


	    // ==========================================================
	    // â˜… åˆæœŸåŒ–
	    // ==========================================================
	    // åˆæœŸåŒ–å‡¦ç†ã¯DOMContentLoadedãŒå®Œäº†ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹
	    document.addEventListener('DOMContentLoaded', () => {
	        showScrollButtonsIfPageLong();
	    });
        </script>
        
    </div>

    <div id="alternativesModal" class="modal">
        <div class="modal-content">
            <h2>èªè­˜å€™è£œã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            <div id="alternativeButtons">
                </div>
            <button id="closeModalButton">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

	  <footer>
	  Â© 20260227 ettomio - èˆã„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
	  </footer>
    
    <div style="height: 60px;"></div>
    
	<script>
	function goBack() {
	    const params = new URLSearchParams(location.search);
	    const from = params.get('from');

	    if (from === 'scribbling') {
	        const origin = params.get('origin');

	        if (origin === 'today') {
	            location.href = 'scribbling.html?from=today';
	        } else {
	            location.href = 'scribbling.html?from=index';
	        }

	    } else if (from === 'notepad') {
	        location.href = 'notepad.html';
	    } else {
	        location.href = 'index.html';
	    }
	}

	</script>
        
</body>
</html>
