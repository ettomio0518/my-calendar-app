<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šæœˆã®è²·ã„ç‰©é‡‘é¡ã®è©³ç´°</title>
    <style>
	    body {
	      font-family: Arial, sans-serif;
		  margin: 0;
		  padding: 0;              /* â† ã“ã“ã‚‚ 0 ã« */
	      background-color: #ffe6ff;
	    }

		.app {
		  width: 100%;
		  max-width: 500px;
		  margin: 0 auto;          /* â† ã“ã“ã§ä¸­å¤®å¯„ã› */
		  padding: 16px;
		  box-sizing: border-box;
		}
		
		section{
		  background:#e3ffff; 
		  margin: 14px 0;   /* â† ç¸¦ã ã‘ä½™ç™½ */
		  padding:14px;
		  border-radius:14px; 
		  box-shadow:0 2px 6px rgba(0,0,0,0.08);
		}
		      
	    .container {
	        max-width: 600px; /* ã‚³ãƒ³ãƒ†ãƒŠã®æœ€å¤§æ¨ªå¹…ã‚’è¨­å®š */
	        margin: 0 auto; /* ä¸­å¤®ã«é…ç½® */
	    }
        .amount-box {
            width: 30%; /* æ¨ªå¹…ã‚’èª¿æ•´ */
            box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚’å«ã‚€ */
        }

		header {
		  background: #8080ff;
		  color: white;
		  padding: 1em 0; /* ä¸Šä¸‹ã®ä½™ç™½ã‚’ã‚‚ã†å°‘ã—ã ã‘èª¿æ•´ */
		  text-align: left;
		  position: relative; 
		}
		h1 {
		  font-size: 18px;
		  margin: 0;  /* ä¸Šä¸‹ãƒ»å³ã¯0 */
		  margin-left: 30px; /* â† å·¦ã«30pxã®ä½™ç™½ */   
		}    
		        
        table {
            width: 100%;
            border-collapse: collapse;
        }

        h2 {
            font-size: 16px;
            margin-bottom: 10px;
        }      
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }
        .action-button {
            margin-top: 10px;
        }
        .action-button2 {
            margin-top: 10px;
            background-color: #ffffbd; /* èƒŒæ™¯è‰² */
        }
        .action-button3 {
            margin-top: 10px;
            border-radius: 5px; /* è§’ã‚’ä¸¸ãã™ã‚‹ */            
            background-color: #d5ffff; /* èƒŒæ™¯è‰² */
            padding: 3px 10px; /* å†…å´ä½™ç™½ */
        }
        .inline {
            display: inline-block;
            margin-right: 5px;
        }
        /* .hidden {
            display: none;
        } */
		.custom-alert {
		    position: fixed;
		    top: 10px;
		    left: 50%;
		    transform: translateX(-50%);
		    background-color: #ffcccb;
		    color: black;
		    padding: 10px 20px;
		    border: 1px solid red;
		    border-radius: 5px;
		    font-size: 16px;
		    z-index: 1000;
		}

	    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ 5/6 */
	    .top-right-button {
          width: auto; /* ãƒœã‚¿ãƒ³ã®å¹…ã‚’è‡ªå‹•èª¿æ•´ */
	      position: absolute;
	      top: 13px;
	      right: 75px;
	      background-color: #ccffff;
	      color: black;
	      border-radius: 20px;
	      padding: 5px 10px;
	      font-size: 14px;
    	  border: 1px solid black; /* æ ç·šã‚’è¡¨ç¤º */	      
	      cursor: pointer;
	    }
	    .top-right-button:hover {
	      background-color: #f4f4f4;
	    }
	    
	    /* homeã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ 5/6 */
	    .top-right2-button {
          width: auto; /* ãƒœã‚¿ãƒ³ã®å¹…ã‚’è‡ªå‹•èª¿æ•´ */
	      position: absolute;
	      top: 13px;
	      right: 10px;
	      background-color: #ccffff;
	      color: black;
	      border-radius: 20px;
	      padding: 5px 10px;
	      font-size: 14px;
    	  border: 1px solid black; /* æ ç·šã‚’è¡¨ç¤º */	      
	      cursor: pointer;
	    }
	    .top-right2-button:hover {
	      background-color: #f4f4f4;
	    }

	    footer {
	      text-align: center;
	      padding: 12px;
	    }	

		/* ã‚¹ãƒãƒ› */
		@media (max-width: 480px) {
		  .app {
		    padding: 10px;   /* â† ã“ã“ãŒåŠ¹ãã¾ã™ */
		  }
		}
			    	    	    
    </style>
</head>

<body>
  <div class="app">
    <div class="container">
    
  	<header>
    <!-- Homeã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ 5/6 -->
	    <button class="top-right-button" onclick="location.href='shopping.html'">back</button>
	    <button class="top-right2-button" onclick="location.href='index.html'">home</button>
	    
	    <h1>ğŸ“„ ä»Šæœˆã®è²·ã„ç‰©è¨˜éŒ²</h1>
  	</header>

	<section>
    <h2>æ—¥ã€…ã®è²·ã„ç‰© â†’ æœˆé›†è¨ˆ</h2>
    <p class="section-note">é¸æŠæœˆã®æ—¥ã€…ã®ãƒ‡ãƒ¼ã‚¿</p> 
        <label for="monthPicker">æœˆé¸æŠ:</label>
        <input type="month" id="monthPicker">
        <button onclick="showMonthlyDetails()">è¡¨ç¤º</button>
        <div id="details"></div>
        <p>10æ—¥é–“å‘¨æœŸãã‚‰ã„ã§ä¿å­˜ã—ã¦ãã ã•ã„</p>

        <button class="action-button" onclick="calculateMonthlyTotal()">æ—¥ã€…ã®é‡‘é¡ã®åˆè¨ˆ</button>
        <label for="monthlyTotal">æœˆé–“åˆè¨ˆ:</label>
        <input type="text" id="monthlyTotal" class="amount-box" readonly> å††
        <button class="action-button2" onclick="saveMonthlyTotal()">ä¿å­˜</button>
        <br>        
        <button class="action-button3" onclick="showHistory()">å±¥æ­´ã‚’è¡¨ç¤º</button><br>
        <p>è¨˜å·ã¯æœŸé–“ã®åç§°ã§ã™</p>
        <div id="history"></div>
	</section>
	
	<section>	
        <h2>æœˆã‚’é¸æŠã—è²·ã„ç‰©åˆè¨ˆé‡‘é¡ã‚’è¡¨ç¤º</h2>
        <label for="selectedMonth">æœˆé¸æŠ:</label>
        <input type="month" id="selectedMonth">
        <br>
        <button class="action-button" onclick="showSelectedMonthTotal()">é¸æŠæœˆã®åˆè¨ˆ</button>
        <label for="selectedMonthTotal">é¸æŠã•ã‚ŒãŸæœˆã®åˆè¨ˆ:</label>
        <input type="text" id="selectedMonthTotal" class="amount-box" readonly> å††
	</section>

    </div>
    </div>

    <script>
        let canShowDeleteButtons = false;
        // let canShowSubDeleteButtons = false; // ä½¿ã£ã¦ã„ãªã„ã®ã§
        let alertShown = false; // ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‹ã‚’è¨˜éŒ²ã™ã‚‹ãƒ•ãƒ©ã‚°

        function showCustomAlert(message) {
            const alertDiv = document.createElement('div');
            alertDiv.classList.add('custom-alert');
            alertDiv.textContent = message;

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 3000); // 3ç§’å¾Œã«å‰Šé™¤
        }

        function showMonthlyDetails() {
            const month = document.getElementById('monthPicker').value;
            if (!month) {
                alert('æœˆã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const detailsDiv = document.getElementById('details');
            detailsDiv.innerHTML = '';

            let lastDay = new Date(parseInt(month.split('-')[0]), parseInt(month.split('-')[1]), 0).getDate();
            let dataExists = false; // æ—¥ã€…ã®ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°

            for (let i = 1; i <= lastDay; i++) {
                const dateKey = `shopping_${month.replace('-', '')}${i.toString().padStart(2, '0')}`;
                const amount = localStorage.getItem(dateKey);
                if (amount) {
                    dataExists = true; // ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’è¨˜éŒ²
                    detailsDiv.innerHTML += `
                        <div id="${dateKey}">
                            <span>${i}æ—¥:</span>
                            <input type="text" value="${amount}" class="amount-box" readonly> å††
                            
                        </div>
                    `;
                }
            }

            if (!dataExists) {
                showCustomAlert('æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
            }
        }

        
        
        function deleteEntry(key) {
            localStorage.removeItem(key);
            const element = document.getElementById(key);
            if (element) {
                element.remove();
            }
        }

        function calculateMonthlyTotal() {
            const month = document.getElementById('monthPicker').value;
            if (!month) {
                alert('æœˆã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            let total = 0;
            let lastDay = new Date(parseInt(month.split('-')[0]), parseInt(month.split('-')[1]), 0).getDate();
            for (let i = 1; i <= lastDay; i++) {
                const dateKey = `shopping_${month.replace('-', '')}${i.toString().padStart(2, '0')}`;
                const amount = parseFloat(localStorage.getItem(dateKey)) || 0;
                total += amount;
            }
            document.getElementById('monthlyTotal').value = total;
        }


		function saveMonthlyTotal() {
		    const month = document.getElementById('monthPicker').value;
		    if (!month) {
		        alert('æœˆã‚’é¸æŠã—ã¦ãã ã•ã„');
		        return;
		    }

		    const totalAmount = document.getElementById('monthlyTotal').value;
		    if (!totalAmount) {
		        alert('åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—ã—ã¦ãã ã•ã„');
		        return;
		    }

		    let subIndex = 1;
		    let key;
		    while (localStorage.getItem(`TA_${month.replace('-', '')}sub${subIndex}`)) {
		        subIndex++;
		    }
		    key = `TA_${month.replace('-', '')}sub${subIndex}`;

		    localStorage.setItem(key, totalAmount);
		    alert(`${key}ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ`);

		    // Show delete buttons after save
		    const detailsDiv = document.getElementById('details');
		    const buttons = detailsDiv.getElementsByTagName('button');
		    for (let button of buttons) {
		        button.classList.remove('hidden');
		    }

		    alert('ãƒ‡ãƒ¼ã‚¿é‡ã®è‚¥å¤§ã¨èª¤è¨ˆç®—ã«ã¤ãªãŒã‚Šã¾ã™ã€‚ä¿å­˜å¾Œã¯æ—¥ã€…ã®æ˜ç´°ã‚’æ¶ˆå»ã—ã¾ã™ã€‚');

		    // ã‚¢ãƒ©ãƒ¼ãƒˆOKå¾Œã«æ—¥ã€…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶çš„ã«å‰Šé™¤
		    const lastDay = new Date(parseInt(month.split('-')[0]), parseInt(month.split('-')[1]), 0).getDate();
		    for (let i = 1; i <= lastDay; i++) {
		        const dateKey = `shopping_${month.replace('-', '')}${i.toString().padStart(2, '0')}`;
		        localStorage.removeItem(dateKey);
		    }
		    document.getElementById('details').innerHTML = ''; // ç”»é¢ã‹ã‚‰ã‚‚å‰Šé™¤
		}


		function showHistory() {
		    const month = document.getElementById('monthPicker').value;
		    if (!month) {
		        alert('æœˆã‚’é¸æŠã—ã¦ãã ã•ã„');
		        return;
		    }

		    const historyDiv = document.getElementById('history');
		    historyDiv.innerHTML = '';

		    let totalAmount = 0;
		    let hasHistory = false; // å±¥æ­´ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°

		    for (let i = 1; ; i++) {
		        const key = `TA_${month.replace('-', '')}sub${i}`;
		        const amount = localStorage.getItem(key);
		        if (!amount) break;
		        hasHistory = true; // å±¥æ­´ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’è¨˜éŒ²
		        totalAmount += parseFloat(amount);
		        historyDiv.innerHTML += `
		            <div id="${key}">
		                <span>${key}:</span>
		                <input type="text" value="${amount}" class="amount-box" readonly> å††
		                
		            </div>
		        `;
		    }

		    if (hasHistory) {
		        historyDiv.innerHTML += `
		            <div class="inline">
		                <label for="historyTotal">æœˆã®åˆè¨ˆ:</label>
		                <input type="text" value="${totalAmount}" id="historyTotal" class="amount-box" readonly> å††
		                <button class="action-button2" onclick="saveHistoryTotal('${month.replace('-', '')}', ${totalAmount})">ä¿å­˜</button>
		            </div>
		        `;
		    } else {
		        showCustomAlert('è¡¨ç¤ºã§ãã‚‹å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
		    }
		}


        function deleteSubEntry(key) {
            localStorage.removeItem(key);
            const element = document.getElementById(key);
            if (element) {
                element.remove();
            }
        }

        function saveHistoryTotal(month, totalAmount) {
            const key = `TA_${month}reg`;
            localStorage.setItem(key, totalAmount);
            alert(`${key}ã¨ã—ã¦ä¿å­˜ã—ã¾ã—ãŸ`);

            canShowSubDeleteButtons = true;

            // Show delete buttons after save
            const historyDiv = document.getElementById('history');
            const buttons = historyDiv.getElementsByTagName('button');
            for (let button of buttons) {
                button.classList.remove('hidden');
            }

            // alert('ä¿å­˜å¾Œã¯æœŸé–“ã®å°è¨ˆã‚’æ¶ˆå»ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚');
        }

        
		// æ—¢å­˜ã®éŸ³å£°å†ç”Ÿé–¢æ•°
		function speakText(text) {
		    if ('speechSynthesis' in window) {
		        const utterance = new SpeechSynthesisUtterance(text);
		        window.speechSynthesis.speak(utterance);
		    } else {
		        alert("éŸ³å£°åˆæˆãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“");
		    }
		}

		// æ–°ã—ã„éŸ³å£°åˆæˆé–¢æ•°
		function nativeSpeak(text) {
		    if (typeof Android !== 'undefined' && Android.speak) {
		        Android.speak(text);
		    } else {
		        speakText(text); // Android.speakãŒä½¿ç”¨ã§ããªã„å ´åˆã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®éŸ³å£°åˆæˆã‚’ä½¿ç”¨
		    }
		}
		        
		function showSelectedMonthTotal() {
		    const month = document.getElementById('selectedMonth').value;
		    if (!month) {
		        alert('æœˆã‚’é¸æŠã—ã¦ãã ã•ã„');
		        return;
		    }

		    const key = `TA_${month.replace('-', '')}reg`;
		    const totalAmount = localStorage.getItem(key) || 0;
		    document.getElementById('selectedMonthTotal').value = totalAmount;

		    // "ã€‡ã€‡å¹´ã€‡ã€‡æœˆ"å½¢å¼ã§ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤º
		    const [year, monthNumber] = month.split('-');
			const message=`${year}å¹´${monthNumber}æœˆã®è²·ã„ç‰©ã®åˆè¨ˆé‡‘é¡ã¯${totalAmount}å††ã§ã™`;    
		    showCustomAlert(message);
		    nativeSpeak(message);
		}

    </script>
    
  <footer>
    Â© 20260108 ettomio
  </footer>
     
</body>

</html>
