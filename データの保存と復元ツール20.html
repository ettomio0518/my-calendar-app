<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>データの保存と復元</title>
  <style>
    body {
      background-color: #cbe4e4;
      font-family: Arial, sans-serif;
    }
    h1 {
      text-align: center;
      font-size: 20px;
    }
    h2, h3, h7 {
      font-size: 18px;
    }
    h3 {
      color: #0000ff;
    }
    h4 {
      font-size: 16px;
      color: red;
    }
    h5 {
      font-size: 16px;
      color: #804040;
    }
    h6 {
      text-align: center;
      font-size: 18px;
      color: #0000ff;
    }
	.h7 {
	  font-size: 18px;
	  color: #008000;
	  font-weight: bold;
	}
   
    p {
      font-size: 16px;
    }
    .note {
      font-size: 14px;
    }
    button {
      padding: 3px 10px;
      background-color: #ccffff;
      border: 1px solid #0000ff;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background-color: #b2ebf2;
    }
    textarea {
      width: 100%;
      height: 200px;
    }
    .right {
      float: right;
    }
    #button2, #button3 {
      background-color: #acffd6;
    }
    #button4 {
      background-color: #ffffbd;
    }
    #button2:hover, #button3:hover, #button4:hover {
      background-color: #e5e5e5;
    }
    
    #keyNButton {
        background-color: #008040;
        color: white;
    }

	/* 6/28 */
	.custom-alert5 {
	    position: fixed;
	    top: 10px;
	    left: 50%;
	    transform: translateX(-50%);
	    background-color:  #000;
	    color: #fff;
	    padding: 10px 20px;
	    border: 1px solid red;
	    border-radius: 5px;
	    font-size: 16px;
	    z-index: 1000;
	}

    h10 {
      font-size: 18px;
    }
	/* 11/4 Top/Bottomボタン */
	.bottom-button, .top-button {
	    position: fixed;
	    bottom: 20px;
	    left: 50%;
	    transform: translateX(-50%);
	    background: #007bff;
	    color: white;
	    border: none;
	    border-radius: 20px;
	    padding: 10px 20px;
	    font-size: 16px;
	    cursor: pointer;
	    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	    z-index: 9999;
	    display: none;
	}
	.bottom-button:hover, .top-button:hover {
	    background: #0056b3;
	}

    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }
      .btn {
        width: 60%;
        text-align: center;
      }
    }    
   </style>
</head>
<body>
  <h1>Web版<br>データの保存と復元ツール</h1>
  <button class="right" onclick="location.href='index.html'">戻る</button>
  <br />

  <label for="output">出力結果:</label>
  <textarea id="output"></textarea>

  <h3>データの出力と保存:</h3>
  <button onclick="outputJSON()">全データをjsonで出力</button>
  <p class="note">アプリの全データが上のテキストボックスに出力されました。</p>
  <button onclick="selectAllAndCopy()">全て選択してコピー</button>
  <p class="note">全データが選択され、コピーされました。</p>
  <br />

  <h3>データの保存:</h3>
  <h4>こちらはAndroidアプリ版では使用できません。</h4>
  <p>Web版使用のみ有効です。</p>
  <button onclick="downloadJSON1()">保存先を選択して保存「カレンダーデータ.json」</button>
  <p class="note">全データが「カレンダーデータ.json」の名前で保存されました。</p>
  <button onclick="downloadJSON2()">保存先を選択して保存「key保存.json」</button>
  <p class="note">全データが「key保存.json」の名前で保存されました。</p>
  <br />
  
  <h3>データの復元:</h3>
  <h4>こちらはAndroidアプリ版では使用できません。</h4>
  <p>Web版使用のみ有効です。</p>
  <button onclick="uploadJSON()">ファイルを選択して復元</button>
  <br /><br />
  <button onclick="restoreData()">データの復元</button>
  <p class="note">データは復元されました。</p>
  <br />
  
　<p class="h7">全データの削除:</p>
  <strong>Androidアプリではアンインストールするとデータは削除されます。</strong>
  <h4>Web版では以下のボタンをクリックして削除します。</h4>
  
  <!--6/28 -->
  <button id="keyNButton2">全keyを消去</button>

　<br>
　　
  <script>
    document.getElementById('button4')?.addEventListener('click', async function () {
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('output').value = text;
      } catch (err) {
        alert('クリップボードの読み取りに失敗しました。\nブラウザやOSの制限が影響している可能性があります。');
        document.getElementById('output').focus();
        document.getElementById('button4').style.display = 'none';
        console.error('Clipboard read failed:', err);
      }
    });

    function outputJSON() {
      const allKeys = Object.keys(localStorage);
      const jsonData = {};
      allKeys.forEach(key => {
        jsonData[key] = localStorage.getItem(key);
      });
      document.getElementById('output').value = JSON.stringify(jsonData);
    }

    function selectAllAndCopy() {
      const output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
    }

    function downloadJSON1() {
      const jsonData = document.getElementById('output').value;
      const blob = new Blob([jsonData], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'カレンダーデータ.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function downloadJSON2() {
      const jsonData = document.getElementById('output').value;
      const blob = new Blob([jsonData], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'key保存.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function uploadJSON() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = function (event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById('output').value = e.target.result;
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function restoreData() {
      const jsonData = document.getElementById('output').value;
      if (jsonData.trim() === "") {
        alert("データが貼り付けられていません。中断します");
        return;
      }
      if (confirm("一応アプリ内のデータをクリアにします")) {
        localStorage.clear();
        const data = JSON.parse(jsonData);
        for (const key in data) {
          localStorage.setItem(key, data[key]);
        }
        alert("データは復元されました");
      }
    }
    
  </script>

	<script> // 6/28
	document.addEventListener('DOMContentLoaded', function() {
	    // ボタン要素を新しいIDで取得
	    const keyNButton = document.getElementById('keyNButton2'); // ここを keyNButton2 に変更

	    // カスタムアラートのコンテナを作成し、新しいクラス名を適用
	    const customAlertContainer = document.createElement('div');
	    customAlertContainer.className = 'custom-alert5'; // ここを custom-alert5 に変更
	    customAlertContainer.style.display = 'none'; // 最初は非表示
	    document.body.appendChild(customAlertContainer); // bodyにアラートコンテナを追加

	    if (keyNButton) {
	        keyNButton.addEventListener('click', function() {
	            // 本当に全データを削除しますか？のアラート表示
	            const confirmation = confirm('本当に全データを削除しますか？');

	            if (confirmation) {
	                // ローカルストレージの全データを消去
	                localStorage.clear();

	                // データは消去されましたのアラート表示
	                showCustomAlert('データは消去されました');
        		    nativeSpeak('データは消去されました');
 	            } else {
	                // キャンセルされた場合、何もしない
	                // showCustomAlert('データ削除はキャンセルされました'); // 必要であればキャンセルのメッセージも表示
	            }
	        });
	    }

	    // カスタムアラートを表示する関数
	    function showCustomAlert(message) {
	        customAlertContainer.textContent = message;
	        customAlertContainer.style.display = 'block';

	        // 3秒後にアラートを非表示にする
	        setTimeout(() => {
	            customAlertContainer.style.display = 'none';
	        }, 3000);
	    }
	});
	</script>
	
	    <button class="top-button" id="topBtn" onclick="scrollToTop()">Top</button>
		<button class="bottom-button" id="bottomBtn" onclick="scrollToBottom()">Bottom</button>
	    

  <script>
	    // ==========================================================
	    // ★ スクロールボタン制御 (Top/Bottom)
	    // ==========================================================

	    function scrollToTop() {
	      window.scrollTo({ top: 0, behavior: 'smooth' });
	    }

	    function scrollToBottom() {
	      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
	    }

	    function hideScrollButtons() {
	        document.getElementById("topBtn").style.display = "none";
	        document.getElementById("bottomBtn").style.display = "none";
	    }

	    // ★ スクロールボタン制御 (Top/Bottom) 11/6
	function showScrollButtonsIfPageLong() {
	    const topBtn = document.getElementById("topBtn");
	    const bottomBtn = document.getElementById("bottomBtn");
	    
	    // ページが十分に長いかチェック (コンテンツが短い場合はボタン不要)
	    const scrollThreshold = 300;
	    const isScrollable = document.body.scrollHeight > window.innerHeight + scrollThreshold; 

	    if (!isScrollable) {
	        hideScrollButtons();
	        return;
	    }

	    // ページが長い場合のスクロール位置による制御
	    const scrollY = window.scrollY;
	    const docHeight = document.body.scrollHeight;
	    const viewHeight = window.innerHeight;
	    const bottomMargin = docHeight - viewHeight - scrollY; // 画面下端からドキュメント下端までの距離
	    
	    // スクロール位置の判定
	    if (scrollY > scrollThreshold) {
	        // [ケース1] ある程度スクロールした -> Topボタンを表示 (Bottomボタンは非表示)
	        topBtn.style.display = "block";
	        bottomBtn.style.display = "none";
	    } else if (scrollY === 0 && bottomMargin > scrollThreshold) {
	        // [ケース2 - 修正箇所] ページ最上部（scrollY=0）にいる場合 -> Bottomボタンを非表示
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "none"; 
	    } else if (bottomMargin > scrollThreshold) {
	        // [ケース3] ページ上部にいるが、底部はまだ遠い -> Bottomボタンを表示
	        // ただし、このelse ifに到達するのは scrollY > 0 の時のみ (ケース2で弾かれるため)
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "block";
	    } else {
	        // [ケース4] ページの下端近くにいる
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "none";
	    }
	}
	
	    // スクロール時のボタン表示制御
	    window.addEventListener("scroll", showScrollButtonsIfPageLong);
	    
	    // 初期ロード時にもボタン表示をチェック
	    window.addEventListener("load", showScrollButtonsIfPageLong);
	    
	    // 画面サイズ変更時にもチェック (スマホの向き変更など)
	    window.addEventListener("resize", showScrollButtonsIfPageLong);


	    // ==========================================================
	    // ★ 初期化
	    // ==========================================================
	    // 初期化処理はDOMContentLoadedが完了したタイミングで実行される
	    document.addEventListener('DOMContentLoaded', () => {
	        showScrollButtonsIfPageLong();
	    });
	    
  </script>
  
  <footer>
    © 20251125 ettomio
  </footer>
  <div style="height: 80px;"></div>  
</body>
</html>
