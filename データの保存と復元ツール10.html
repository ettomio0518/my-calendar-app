<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>データの保存と復元</title>
  <style>
    body {
      background-color: #cbe4e4;
      font-family: Arial, sans-serif;
    }
    h1 {
      text-align: center;
      font-size: 20px;
    }
    h2, h3 {
      font-size: 18px;
    }
    h3 {
      color: #0000ff;
    }
    h4 {
      font-size: 16px;
      color: red;
    }
    h5 {
      font-size: 16px;
      color: #804040;
    }
    p {
      font-size: 16px;
    }
    .note {
      font-size: 14px;
    }
    button {
      padding: 3px 10px;
      background-color: #ccffff;
      border: 1px solid #0000ff;
      border-radius: 5px;
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background-color: #b2ebf2;
    }
    textarea {
      width: 100%;
      height: 200px;
    }
    .right {
      float: right;
    }
    #button2, #button3 {
      background-color: #acffd6;
    }
    #button4 {
      background-color: #ffffbd;
    }
    #button2:hover, #button3:hover, #button4:hover {
      background-color: #e5e5e5;
    }
	/* 11/4 Top/Bottomボタン */
	.bottom-button, .top-button {
	    position: fixed;
	    bottom: 20px;
	    left: 50%;
	    transform: translateX(-50%);
	    background: #007bff;
	    color: white;
	    border: none;
	    border-radius: 20px;
	    padding: 10px 20px;
	    font-size: 16px;
	    cursor: pointer;
	    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	    z-index: 9999;
	    display: none;
	}
	.bottom-button:hover, .top-button:hover {
	    background: #0056b3;
	}

    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }
      .btn {
        width: 60%;
        text-align: center;
      }
    }    
  </style>
</head>
<body>
  <h1>Androidアプリ版<br>データの保存と復元ツール</h1>
  <button class="right" onclick="location.href='index.html'">戻る</button>

  <h3>初めに:</h3>
  <p>
    WebViewを使用する本アプリの操作に関する手順を説明します。現在、自動操作機能はOSの制約で実装できないため、手動操作が必要ですが以下の手順で対応してください。
    <br />
    <strong>
      なお、水色ボタンと黄緑のボタンと黄色のボタンを順番に使用すると若干操作は軽減されるかと思います。<br />
      ただしWiFi接続環境で使用してください。
    </strong>
  </p>

  <h3>必要なアプリの準備：</h3>
  <p>・GooglePlayで「ファイルマネージャー」か「Files by Google」をインストールします。</p>

  <label for="output">出力結果:</label>
  <textarea id="output"></textarea>

  <h3>データの出力と保存:</h3>
  <button onclick="outputJSON()">全データをjsonで出力</button>
  <p class="note">アプリの全データが上のテキストボックスに出力されました。</p>
  <button onclick="selectAllAndCopy()">全て選択してコピー</button>
  <p class="note">全データが選択され、コピーされました。</p>
  <p class="note">
    ・「QuickEdit」または「Jota＋」で新規ファイルを作成し、データを貼り付けます。<br />
    ・任意のファイル名（例：「データ保存」）で、拡張子を.txtまたは.jsonに設定して (UTF-8形式で) 保存します。保存場所は「Download」フォルダを指定します。
  </p>
  <button id="button2">外部ツールを呼び出し</button>

  <h3>バックアップ:</h3>
  <p>
    ・「ファイルマネージャー」や「Files by Google」を使用し、保存したファイルをGoogleDriveやメールにてバックアップ。またはSDカードやUSBメモリに保存します。
  </p>

  <h3>データの復元:</h3>
  <p class="note">
    ・GoogleDriveやSDカードなどからファイルをダウンロードし、再度「Download」フォルダに保存します。<br />
    ・ファイルを開き、データをコピーして、「データの保存と復元.html」のテキストボックスに貼り付けます。
  </p>
  <button id="button3">外部ツールを呼び出し</button>
  <br /><br />
  <p class="note">上のテキストボックスにデータを貼り付けて下さい。</p>
  <button id="button4">クリップボードから貼り付け</button>
  <br />
  <p><strong>・ここで失敗した場合は、上のテキストボックス内を長押しして『貼り付け』を実行してください。</strong></p>
  <button onclick="restoreData()">データの復元</button>
  <p class="note">データは復元されました。</p>

  <script>
    document.getElementById('button2').addEventListener('click', function () {
      window.open('https://ettomio0518.github.io/data-save-tool/data-save-tool-new.html', '_blank');
    });

    document.getElementById('button3').addEventListener('click', function () {
      window.open('https://ettomio0518.github.io/data-load-tool/data-load-tool-new.html', '_blank');
    });

    document.getElementById('button4').addEventListener('click', async function () {
      try {
        const text = await navigator.clipboard.readText();
        document.getElementById('output').value = text;
      } catch (err) {
        alert('クリップボードの読み取りに失敗しました。\nブラウザやOSの制限が影響している可能性があります。');
        document.getElementById('output').focus();
        document.getElementById('button4').style.display = 'none';
        console.error('Clipboard read failed:', err);
      }
    });

    function outputJSON() {
      const allKeys = Object.keys(localStorage);
      const jsonData = {};
      allKeys.forEach(key => {
        jsonData[key] = localStorage.getItem(key);
      });
      document.getElementById('output').value = JSON.stringify(jsonData);
    }

    function selectAllAndCopy() {
      const output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
    }

    function restoreData() {
      const jsonData = document.getElementById('output').value;
      if (jsonData.trim() === "") {
        alert("データが貼り付けられていません。中断します");
        return;
      }
      if (confirm("一応アプリ内のデータをクリアにします")) {
        localStorage.clear();
        const data = JSON.parse(jsonData);
        for (const key in data) {
          localStorage.setItem(key, data[key]);
        }
        alert("データは復元されました");
      }
    }
  </script>

	    <button class="top-button" id="topBtn" onclick="scrollToTop()">Top</button>
		<button class="bottom-button" id="bottomBtn" onclick="scrollToBottom()">Bottom</button>
	    

  <script>
	    // ==========================================================
	    // ★ スクロールボタン制御 (Top/Bottom)
	    // ==========================================================

	    function scrollToTop() {
	      window.scrollTo({ top: 0, behavior: 'smooth' });
	    }

	    function scrollToBottom() {
	      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
	    }

	    function hideScrollButtons() {
	        document.getElementById("topBtn").style.display = "none";
	        document.getElementById("bottomBtn").style.display = "none";
	    }

	    // ★ スクロールボタン制御 (Top/Bottom) 11/6
	function showScrollButtonsIfPageLong() {
	    const topBtn = document.getElementById("topBtn");
	    const bottomBtn = document.getElementById("bottomBtn");
	    
	    // ページが十分に長いかチェック (コンテンツが短い場合はボタン不要)
	    const scrollThreshold = 300;
	    const isScrollable = document.body.scrollHeight > window.innerHeight + scrollThreshold; 

	    if (!isScrollable) {
	        hideScrollButtons();
	        return;
	    }

	    // ページが長い場合のスクロール位置による制御
	    const scrollY = window.scrollY;
	    const docHeight = document.body.scrollHeight;
	    const viewHeight = window.innerHeight;
	    const bottomMargin = docHeight - viewHeight - scrollY; // 画面下端からドキュメント下端までの距離
	    
	    // スクロール位置の判定
	    if (scrollY > scrollThreshold) {
	        // [ケース1] ある程度スクロールした -> Topボタンを表示 (Bottomボタンは非表示)
	        topBtn.style.display = "block";
	        bottomBtn.style.display = "none";
	    } else if (scrollY === 0 && bottomMargin > scrollThreshold) {
	        // [ケース2 - 修正箇所] ページ最上部（scrollY=0）にいる場合 -> Bottomボタンを非表示
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "none"; 
	    } else if (bottomMargin > scrollThreshold) {
	        // [ケース3] ページ上部にいるが、底部はまだ遠い -> Bottomボタンを表示
	        // ただし、このelse ifに到達するのは scrollY > 0 の時のみ (ケース2で弾かれるため)
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "block";
	    } else {
	        // [ケース4] ページの下端近くにいる
	        topBtn.style.display = "none";
	        bottomBtn.style.display = "none";
	    }
	}
	
	    // スクロール時のボタン表示制御
	    window.addEventListener("scroll", showScrollButtonsIfPageLong);
	    
	    // 初期ロード時にもボタン表示をチェック
	    window.addEventListener("load", showScrollButtonsIfPageLong);
	    
	    // 画面サイズ変更時にもチェック (スマホの向き変更など)
	    window.addEventListener("resize", showScrollButtonsIfPageLong);


	    // ==========================================================
	    // ★ 初期化
	    // ==========================================================
	    // 初期化処理はDOMContentLoadedが完了したタイミングで実行される
	    document.addEventListener('DOMContentLoaded', () => {
	        showScrollButtonsIfPageLong();
	    });
	    
  </script>
  
  <footer>
    © 20251125 ettomio
  </footer>
  <div style="height: 80px;"></div>  
</body>
</html>
