<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡æ˜“æ—¥è¨˜</title>
    <style>
	    body {
	      font-family: Arial, sans-serif;
	      padding: 20px;
	      max-width: 500px;
	      margin: auto;
	      background-color: #ffe6ff;
	    }
		.app-header {
		  background: #8080ff;
		  color: white;

		  display: flex;
		  align-items: center;        /* â† ç¸¦ä¸­å¤® */
		  justify-content: space-between;

		  padding: 10px 14px;         /* â† ä½™ç™½ã‚’æœ€å°é™ã« */
		}

		.app-header h1 {
	  	  /* margin: 0;   */    /* â† ã“ã‚Œè¶…é‡è¦ */
  		  margin-left: 30px; /* â† å·¦ã«30pxã®ä½™ç™½ */  
		  font-size: 18px;
		  font-weight: normal;
		}
		            
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 600px;
            margin: auto;
            background-color: #cbe4e4;
        }

        h2 {
            font-size: 18px;
            color: blue;
        }
		.input-row {
		  display: flex;
		  flex-direction: column;
		  align-items: flex-start;
		  gap: 10px;              /* â† ã“ã‚Œã‚’è¿½åŠ  */
		  margin-bottom: 10px;
		  width: 100%;
		}

        .input-row label, .input-row input, .input-row textarea, .input-row button {
            margin: 5px;
        }
        .input-row textarea {
            font-size: 16px;
            width: 95%;
            min-height: 150px;
            max-height: 300px;
        }
        .input-row input {
            height: 30px;
            font-size: 16px;
        }
        .table-container {
            width: 100%;
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
			border-collapse: collapse; /* â† é‡è¦ */            
        }
        th, td {
            border: 1px solid #ddd;
			padding: 6px 6px;   /* â† ã“ã“ã‚’è©°ã‚ã‚‹ */
            text-align: left;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        th.date-column, td.date-column {
		    width: 20%;
		    max-width: 6ch;  /* æ—¥ä»˜éƒ¨åˆ†ã®å¹…ã‚’èª¿æ•´ */
		}
        th.content-column, td.content-column {
		    width: 50%;
		    max-width: 10ch; /* æ—¥è¨˜å†…å®¹ã®éƒ¨åˆ†ã®å¹…ã‚’èª¿æ•´ */
		}
        th.actions-column, td.actions-column {
	    	width: 30%; /* æ“ä½œéƒ¨åˆ†ã®å¹…ã‚’èª¿æ•´ */
    	    text-align: center;
		}
		td.actions-column button {
		    display: inline-block; /* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã§ä¸­å¤®å¯„ã› */
		}


        #diaryList {
            width: 100%;
        }
        button {
            font-size: 14px;
            padding: 5px 10px; /* ãƒœã‚¿ãƒ³ã®ä½™ç™½ã‚’èª¿æ•´ */
            background-color: #f7eeff;
            color: black;
            border: 1px solid #0000ff;
            border-radius: 5px;            
            cursor: pointer;
            min-width: 80px;   /* æœ€å°å¹…ã‚’è¨­å®š */
            display: inline-block; /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        }
        
		.nav-button {
		  min-width: 3em;
		  padding: 0.25em 0.35em;
		  border-radius: 6px;
		  font-size: 15px;
		  line-height: 1.2;
		  white-space: nowrap;    /* è¶…é‡è¦ */
		}

		.nav-button2 {
		  min-width: 2.2em;
		  padding: 0.25em 0;
		  text-align: center;
		  font-size: 16px;        /* è¨˜å·ã¯å°‘ã—å¤§ãã */
		  line-height: 1.2;
		  white-space: nowrap;
		}   
        .save-button {
            padding: 3px 10px;
            background-color: #ffdbed;
            border-radius: 5px;
            cursor: pointer;            
        }

        .btn-show-text {  /* 3/15ã« */
            font-size: 14px;
            padding: 3px 5px; /* ãƒœã‚¿ãƒ³ã®ä½™ç™½ã‚’èª¿æ•´ */
            background-color: #ffe9d2;
            color: black;
            border: 1px solid #0000ff;
            border-radius: 5px;            
            cursor: pointer;
            min-width: 60px;   /* æœ€å°å¹…ã‚’è¨­å®š */
            display: inline-block; /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        }
        
        #closeList {
            background-color: #acffd6;
        }
        
		#monthSelection {
		    display: flex;
		    gap: 10px; /* `input` ã¨ `button` ã®é–“ã«ä½™ç™½ã‚’ã¤ã‘ã‚‹ */
		    align-items: center; /* ç¸¦ã®ä¸­å¤®æƒãˆ */
		}

        .custom-alert {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffcccb;
            color: black;
            padding: 10px 20px;
            border: 1px solid red;
            border-radius: 5px;
            font-size: 16px;
            z-index: 1000;
        }

		.date-row {
		  display: flex;
		  align-items: center;
		  gap: 4px;
		  flex-wrap: nowrap;
		}

		#date {
		  min-width: 120px;
		  max-width: 150px;
		  flex-shrink: 1;
		}
        
		/* 11/4 Top/Bottomãƒœã‚¿ãƒ³ */
		.bottom-button, .top-button {
		    position: fixed;
		    bottom: 20px;
		    left: 50%;
		    transform: translateX(-50%);
		    background: #a74fff;
		    color: white;
		    border: none;
		    border-radius: 20px;
		    padding: 10px 20px;
		    font-size: 16px;
		    cursor: pointer;
		    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
		    z-index: 9999;
		    display: none;
		}
		.bottom-button:hover, .top-button:hover {
		    background: #0056b3;
		}    
	
	    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ 5/6 */
	    .top-right-button {
	      width: auto; /* ãƒœã‚¿ãƒ³ã®å¹…ã‚’è‡ªå‹•èª¿æ•´ */
		  position: static;           /* â† absolute ã‚’ã‚„ã‚ã‚‹ */
	      top: 15px;
	      right: 10px;
	      background-color: #e1ffff;
	      color: #400040;
		  border: 1px solid #ff8000; /* æ ç·šã‚’è¡¨ç¤º */		      
	      border-radius: 20px;
	      padding: 4px 12px;
	      font-size: 14px;
	      cursor: pointer;
	    }
	    .top-right-button:hover {
	      background-color: #e3e3f0;
	    }

	    footer {
	      text-align: center;
	      padding: 12px;
	    }	   

		.list-title {
		  margin: 6px 0 6px;
		  font-weight: bold;
		}

		@media (max-width: 600px) {
		  th, td {
		    padding: 4px 4px;
		    font-size: 14.5px;
			line-height: 1.4;
		  }
		}


    </style>
</head>
<body>

	<header class="app-header">
	  <h1>ğŸ“˜ ç°¡æ˜“æ—¥è¨˜ diary</h1>
	  <button class="top-right-button"
	   onclick="goBack()">æˆ»ã‚‹</button>
	</header>

	<script>
	function goBack() {
	  if (history.length > 1) {
	    history.back();
	  } else {
	    location.href = 'index.html';
	  }
	}
	</script>


    <div class="container">
    <div class="input-row">

      <!-- æ—¥ä»˜æ“ä½œè¡Œ -->
	<div class="date-row">
	  <button class="nav-button2" onclick="changeDate(-1)">â—</button>
	  <button class="nav-button" onclick="setToday()">ä»Šæ—¥</button>
	  <button class="nav-button2" onclick="changeDate(1)">â–·</button>

	  <input type="date" id="date">
	</div>


      <!-- æ—¥è¨˜å…¥åŠ› -->
      <!-- <label for="diaryContent">æ—¥è¨˜:</label> -->
      <textarea id="diaryContent" rows="12"></textarea>

      <button class="save-button" onclick="saveDiary()">ğŸ’¾ ä¿å­˜</button>

    </div>

	<p class="list-title">æ—¥è¨˜ã‚’è¡¨ç¤º</p>

    <div id="monthSelection">
      <label for="monthInput">æœˆã‚’é¸æŠ:</label>
      <input type="month" id="monthInput">
      <button onclick="showSelectedMonth()">è¡¨ç¤º</button>
    </div>

    <button id="closeList" onclick="closeDiaryList()" style="display:none;">ãƒªã‚¹ãƒˆã‚’é–‰ã˜ã‚‹</button>
    <h2 id="selectedMonth" style="display:none;"></h2>
    <div id="diaryList" class="table-container" style="display:none;"></div>
  </div>

  <script>
    let displayedYear = new Date().getFullYear();
    let displayedMonth = new Date().getMonth() + 1;

    // ä»Šæ—¥ã‚’ YYYY-MM-DD ã§è¿”ã™ï¼ˆJSTåŸºæº–ï¼‰
    function getTodayStr() {
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }


	function loadDiaryByDate(dateStr) {
	  const key = `diary_${dateStr.replace(/-/g, '')}`;
	  const saved = localStorage.getItem(key);
	  document.getElementById('diaryContent').value = saved ? saved : '';
	}


    // ä»Šæ—¥ã‚’ã‚»ãƒƒãƒˆ
	function setToday() {
	  const today = getTodayStr();
	  document.getElementById('date').value = today;
	  loadDiaryByDate(today);
	}


    // å‰æ—¥ãƒ»ç¿Œæ—¥ã¸ç§»å‹•
	function changeDate(diff) {
	  const dateInput = document.getElementById('date');
	  if (!dateInput.value) {
	    setToday();
	    return;
	  }
	  const d = new Date(dateInput.value);
	  d.setDate(d.getDate() + diff);

	  const y = d.getFullYear();
	  const m = String(d.getMonth() + 1).padStart(2, '0');
	  const day = String(d.getDate()).padStart(2, '0');
	  const newDate = `${y}-${m}-${day}`;

	  dateInput.value = newDate;
	  loadDiaryByDate(newDate);
	}


    // åˆæœŸè¡¨ç¤ºã¯ä»Šæ—¥
    window.addEventListener('DOMContentLoaded', () => {
      setToday();
    });

    // ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥
    function showCustomAlert(message) {
      const alertContainer = document.createElement('div');
      alertContainer.className = 'custom-alert';
      alertContainer.textContent = message;
      document.body.appendChild(alertContainer);
      setTimeout(() => {
        document.body.removeChild(alertContainer);
      }, 5000);
    }

    // æ—¥ä»˜å¤‰æ›´æ™‚ mm/dd ã‚’æœ¬æ–‡ã¸è»¢é€
	document.getElementById('date').addEventListener('change', function () {
	  const selectedDate = this.value;
	  if (!selectedDate) return;

	  loadDiaryByDate(selectedDate);

	  const mmdd = selectedDate.slice(5).replace('-', '/');
	  const diaryContent = document.getElementById('diaryContent');
	  if (!diaryContent.value.startsWith(mmdd)) {
	    diaryContent.value = mmdd + ' ' + diaryContent.value;
	  }
	});


    function saveDiary() {
      const date = document.getElementById('date').value;
      const diaryContent = document.getElementById('diaryContent').value.trim();
      if (!date) {
        showCustomAlert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      if (diaryContent.length < 1) {
        showCustomAlert('æ—¥è¨˜å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const key = `diary_${date.replace(/-/g, '')}`;
      localStorage.setItem(key, diaryContent);
      showCustomAlert('æ—¥è¨˜ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');
      document.getElementById('date').value = '';
      document.getElementById('diaryContent').value = '';
    }

    function showSelectedMonth() {
      const monthInput = document.getElementById('monthInput').value;
      if (!monthInput) {
        showCustomAlert('å¹´æœˆã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const [year, month] = monthInput.split('-').map(Number);
      displayedYear = year;
      displayedMonth = month;
      document.getElementById('selectedMonth').innerHTML = `<span>${year}å¹´</span>${month}æœˆ`;
      document.getElementById('selectedMonth').style.display = 'block';
      document.getElementById('monthSelection').style.display = 'none';
      document.getElementById('closeList').style.display = 'block';
      displayDiaries(year, month);
    }

    function closeDiaryList() {
      document.getElementById('diaryList').style.display = 'none';
      document.getElementById('selectedMonth').style.display = 'none';
      document.getElementById('monthSelection').style.display = 'block';
      document.getElementById('closeList').style.display = 'none';
      clearDetailInputs();
    }

    function displayDiaries(year, month) {
      const keys = Object.keys(localStorage)
        .filter(key => key.startsWith('diary_'))
        .sort((a, b) => {
          const da = a.split('_')[1];
          const db = b.split('_')[1];
          return new Date(da.slice(0,4), da.slice(4,6)-1, da.slice(6,8))
               - new Date(db.slice(0,4), db.slice(4,6)-1, db.slice(6,8));
        });

      const diaryList = document.getElementById('diaryList');
      diaryList.innerHTML = '';

      const table = document.createElement('table');
      const headerRow = document.createElement('tr');
      ['æ—¥ä»˜','æ—¥è¨˜å†…å®¹','æ“ä½œ'].forEach(t => {
        const th = document.createElement('th');
        th.textContent = t;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      keys.forEach(key => {
        const date = key.split('_')[1];
        const diaryDate = new Date(date.slice(0,4), date.slice(4,6)-1, date.slice(6,8));
        if (diaryDate.getFullYear() === year && diaryDate.getMonth()+1 === month) {
          const row = document.createElement('tr');
          const dateCell = document.createElement('td');
          const contentCell = document.createElement('td');
          const actionsCell = document.createElement('td');
          dateCell.textContent = `${diaryDate.getFullYear()}-${String(diaryDate.getMonth()+1).padStart(2,'0')}-${String(diaryDate.getDate()).padStart(2,'0')}`;
          contentCell.textContent = localStorage.getItem(key).substring(0,40) + '...';
          const viewButton = document.createElement('button');
          viewButton.textContent = 'è¡¨ç¤º';
          viewButton.className = 'btn-show-text';
          viewButton.onclick = () => {
            document.getElementById('date').value = dateCell.textContent;
            document.getElementById('diaryContent').value = localStorage.getItem(key);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          };
          actionsCell.appendChild(viewButton);
          row.appendChild(dateCell);
          row.appendChild(contentCell);
          row.appendChild(actionsCell);
          table.appendChild(row);
        }
      });

      diaryList.appendChild(table);
      diaryList.style.display = 'block';
    }

    function clearDetailInputs() {
      document.getElementById('date').value = '';
      document.getElementById('diaryContent').value = '';
    }
  </script>

	    <button class="top-button" id="topBtn" onclick="scrollToTop()">Top</button>
		<button class="bottom-button" id="bottomBtn" onclick="scrollToBottom()">Bottom</button>
	    

  <script>
	    // ==========================================================
	    // â˜… ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³åˆ¶å¾¡ (Top/Bottom)
	    // ==========================================================

	    function scrollToTop() {
	      window.scrollTo({ top: 0, behavior: 'smooth' });
	    }

	    function scrollToBottom() {
	      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
	    }

	    function hideScrollButtons() {
	        document.getElementById("topBtn").style.display = "none";
	        document.getElementById("bottomBtn").style.display = "none";
	    }

		// ==========================================================
		// â˜… ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³åˆ¶å¾¡ã®ä¿®æ­£ç‰ˆ (Top/Bottom ç‹¬ç«‹åˆ¶å¾¡) 12/02
		// ==========================================================
		function showScrollButtonsIfPageLong() {
		    const topBtn = document.getElementById("topBtn");
		    const bottomBtn = document.getElementById("bottomBtn");
		    
		    const docHeight = document.body.scrollHeight;
		    const viewHeight = window.innerHeight;
		    const scrollY = window.scrollY;
		    
		    const scrollThreshold = 100; // ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã—ãã„å€¤ (px)
		    
		    // ãƒšãƒ¼ã‚¸ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã§ãªã‘ã‚Œã°ä¸¡æ–¹éè¡¨ç¤º
		    if (docHeight <= viewHeight + scrollThreshold) {
		        topBtn.style.display = "none";
		        bottomBtn.style.display = "none";
		        return;
		    }

		    // --- Topãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡ ---
		    // 100pxä»¥ä¸Šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸã‚‰Topãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
		    if (scrollY > scrollThreshold) {
		        topBtn.style.display = "block";
		    } else {
		        topBtn.style.display = "none";
		    }

			// --- Bottomãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡ ---
			// 100pxä»¥ä¸Šã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« ã‹ã¤ ä¸‹ç«¯ã¾ã§ä½™è£•ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤º
			if (
			    scrollY > scrollThreshold &&
			    docHeight - viewHeight - scrollY > scrollThreshold
			) {
			    bottomBtn.style.display = "block";
			} else {
			    bottomBtn.style.display = "none";
			}
		}

	    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡
	    window.addEventListener("scroll", showScrollButtonsIfPageLong);
	    
	    // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚ãƒœã‚¿ãƒ³è¡¨ç¤ºã‚’ãƒã‚§ãƒƒã‚¯
	    window.addEventListener("load", showScrollButtonsIfPageLong);
	    
	    // ç”»é¢ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ã‚‚ãƒã‚§ãƒƒã‚¯ (ã‚¹ãƒãƒ›ã®å‘ãå¤‰æ›´ãªã©)
	    window.addEventListener("resize", showScrollButtonsIfPageLong);


	    // ==========================================================
	    // â˜… åˆæœŸåŒ–
	    // ==========================================================
	    // åˆæœŸåŒ–å‡¦ç†ã¯DOMContentLoadedãŒå®Œäº†ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹
	    document.addEventListener('DOMContentLoaded', () => {
	        showScrollButtonsIfPageLong();
	    });
	    
  </script>
  
  <footer>
    Â© 20260106 ettomio
  </footer>
  <div style="height: 50px;"></div>
  
  </body>
</html>

